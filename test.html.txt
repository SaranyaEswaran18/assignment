@extends('layouts.admin.global')
@section('title', $ticket->default_subject)

@section('body_class', 'viewpage-accordian-header ui-alter ticket-view')

@section('content')
<style type="text/css">
    .task-position{
        width: 30px;
        margin-right: 30px;
        background: rgba(0, 0, 0, 0);
        border: none;
    }
    .task-number{
        background: rgba(0, 0, 0, 0);
        border: none;
    }
    .ticket-panel.full-height .message-body{
        opacity:1;
    }
    .result-card{
       margin-left: 11px;
    }
    .activitylog-text-panel .list-content {
     margin-top: 9px;
    }
    .act-expandcollapse-tag{
        right:207px; 
       }
    #ec_ticket_container, #gridviewchecklistaccordian_form, #act_textmessage_allmessages, #ec_mail_top_messages{
        border:none;
    }
    /* .form-group{
        margin-bottom: 0;
    } */
    
    @media (min-width: 1350px){
        #mob-ticket-reply-click{position: absolute;top: 25px;left: 185px;}
    }
    @media(max-width:468px){
        .cus-table-header > div{margin-top: 0;}
        .ticket-number-class,.ticket-number,{display: none;}
        /* .right{display: none;} */
        .page {top: 175px !important;min-height: 70vh;}
        .inner-breadcrumb .breadcrumb-item.active span{white-space: nowrap;overflow: hidden;text-overflow: ellipsis;width: 140px;}
        .ticktesview-innerpage.has-customer .ticketview-content-startpanel{position: unset;}
        .content-container{padding: 2px;}
        .title-container.customer-fixed-header.topbar{position: fixed;top: 115px;z-index: 1000;height: 60px; padding: 10px 0 0 0;}
        .ticktesview-innerpage .title-container.customer-fixed-header.secondBar{position: unset;}
        .inner-breadcrumb .breadcrumb-item.active span { margin: 0 }
    }
    ul.pagination.customer-pagination {
        position: unset;
        align-items: flex-end;
        padding-right: 18px;
    }
</style>
<!-- <div class="page view-notes inner-page ticktesview-innerpage {{ ($ticket->customer && $ticket->ticket_type == 'customer' || $ticket->ticket_type == 'partner'  || $ticket->ticket_type == 'internal') ? 'has-customer' : '' }}"> -->
    <div class="tckt-view page view-notes inner-page ticktesview-innerpage has-customer {{$ticket->ticket_type == 'hiring' ? 'hiring_top':''}} {{$ticket->status == 'closed' ? 'closed-tckt' :'' }}"> 
    @php
    $ticketcreator =   $ticket->creator;
    if($ticket->is_job_applicant == 1){	
        $ticketUser = $user = $ticket->applicant;	
    }else{	
        $ticketUser = $user = $ticket->customer;	
    }
    if($ticket->ticket_type == 'partner' && $ticket->partner) {
       $ticketUser =  $user = $ticket->partner;
    }
    if($ticket->ticket_type == 'hiring' && $ticket->applicant) {	
       $ticketUser =  $user = $ticket->applicant;	
    }
    $checklists1 = $ticket->checklists;
    $completedChecklists1 = $ticket->completedChecklists; 
    $checklists = $ticket->checklists->count();
    $completedChecklists = $ticket->completedChecklists->count();
    $incompletedChecklists = abs($completedChecklists - $checklists);
    $percent = 0;
    $percentage = 0;
    if(count($checklists) == 0) {
       $percentage = 0;
   } elseif($checklists != 0) {
       $percent =  $completedChecklists/$checklists;
       $percentage = number_format( $percent * 100 );
   }
   $contacts = $ticket->contacts;
   $ticketassignTo = $ticket->assignTo;

   $notesCount = $ticket->notes->count();
   
    $taccessibleUsers = $ticket->accessibleUsers;
    $tassignTo =   $ticket->assignTo;
    $tcustomer = $ticket->customer;
    $tpartner = $ticket->partner;
    $assignedProperty = $ticket->assignedProperty;

    $customerEmails = $allEmails =  [];
    $passNames = $tassignTo? $tassignTo->name.", " : "";
    if($ticket->ticket_type == 'hiring'){	
        $tcustomer = $ticket->applicant;	
        $customerEmails[] = $tcustomer->first_name." ".$tcustomer->last_name."<".$tcustomer->email.">";	
    }

    if($tcustomer && $ticket->ticket_type == 'customer') {
        if( $tcustomer->email != "" && $tcustomer->has_deleted == 0) {
            $customerEmails[] = $tcustomer->first_name." ".$tcustomer->last_name."<".$tcustomer->email.">";
            $allEmails[] = strtolower($tcustomer->email);
            $otherEmails = $ticketcreator->truncateEmail( $ticketcreator->getUserEmails($tcustomer->id), $tcustomer->email);
            if(count($otherEmails) > 0) {
                $nameByEmails = $tcustomer->nameByEmails($tcustomer->id);
                foreach ($otherEmails as $key => $otherEmail) {
                    if(!in_array($otherEmail, $allEmails)) {
                        $customerEmails[] = $nameByEmails[$otherEmail] ? $nameByEmails[$otherEmail]."<".$otherEmail.">" :  $otherEmail;
                        $allEmails[] = strtolower($otherEmail);
                    }
                }
            }
        }
    }

    if($ticket->property_id != 0  && $ticket->ticket_type == 'customer' ) {
        $property = $assignedProperty;
        if($property) {
            $buyerGroupUsers = $property->buyerGroupUsers();
            if(count($buyerGroupUsers) > 0) {
                    foreach ($buyerGroupUsers as $key => $buyerGroupUser) {
                        $nameByEmails = $buyerGroupUser->nameByEmails($buyerGroupUser->id); 
                        if(!in_array(strtolower($buyerGroupUser->email), $allEmails) ) {
                            $customerEmails[] = $nameByEmails[$buyerGroupUser->email] ? $nameByEmails[$buyerGroupUser->email]."<".$buyerGroupUser->email.">" :  $buyerGroupUser->email;
                            $allEmails[] = strtolower($buyerGroupUser->email);
                        }
                        $otherBuyerEmails = $ticketcreator->truncateEmail( $ticketcreator->getUserEmails($buyerGroupUser->id), $buyerGroupUser->email);
                        if(count($otherBuyerEmails) > 0) {
                            foreach ($otherBuyerEmails as $key => $otherBuyerEmail) {
                                if(!in_array(strtolower($otherBuyerEmail), $allEmails) ) {
                                    $customerEmails[] = @$nameByEmails[$otherBuyerEmail] ? $nameByEmails[$otherBuyerEmail]."<".$otherBuyerEmail.">" :  $otherBuyerEmail;
                                    $allEmails[] = strtolower($otherBuyerEmail);
                                }
                            }
                        }
                    }   
            }
        }
    }
    
    if($tpartner && $ticket->ticket_type == 'partner') {
        if( $tpartner->email != "" && $tpartner->has_deleted == 0 ) {
            if(!in_array(strtolower($tpartner->email), $excludeEmails)) {
                $customerEmails[] = $tpartner->name."<".$tpartner->email.">";
            }
            $allEmails[] = $tpartner->email;
            $otherEmails = $ticket->creator->truncateEmail( $ticket->creator->getUserEmails($tpartner->id), $tpartner->email);
            if(count($otherEmails) > 0) {
                $nameByEmails = $tpartner->nameByEmails($customer->id);
                foreach ($otherEmails as $key => $otherEmail) {
                    if(!in_array($otherEmail, $customerEmails)) {
                        $customerEmails[] =  $nameByEmails[$otherEmail] ? $nameByEmails[$otherEmail] :  $otherEmail;
                        $allEmails[] = $otherEmail;
                    }
                }
            }
        }
    }
    
    if($taccessibleUsers) {
        foreach ($taccessibleUsers as $accessibleUser) {
            if($accessibleUser->user->email && $accessibleUser->user->has_deleted == 0) {
                if(!in_array($accessibleUser->user->email , $allEmails)) {
                    $customerEmails[] = $accessibleUser->user->name."<".$accessibleUser->user->email.">";
                    $allEmails[] = $accessibleUser->user->email;
                }
            }
        }
    }

    if(count($customerEmails) > 0) {
        $passNames .= implode(", ", $customerEmails);
    }
    $passNames = trim($passNames);
    $passNames = trim($passNames, ","); 


    @endphp
    <input type="hidden" name="hidden_ticket_id" id="hidden_ticket_id" value="{{ $ticket->id }}">
    <div class="title-container customer-fixed-header topbar hiring-titles hiring-titlebar {{ $ticket->ticket_type == 'internal' ? 'has-internal-topbar' : 'has-customer-topbar' }}">
        <div class="container-fluid candidate-itemlist">
            <div class="row">
                <div class="col-12 col-md-12">
                    <div class="primary-info inner-breadcrumb ">
                        <ol class="breadcrumb aos-init aos-animate" data-aos="fade-right" data-aos-once="true">
                            <li class="breadcrumb-item"><a href="{{ route('admindashboard') }}">Dashboard</a></li>
                            @if($ticket->is_job_applicant == 1)	
                                <li class="breadcrumb-item">Hiring</li>	
                                <li class="breadcrumb-item">	
                                            <a class="" href="{{ URL::action('Admin\\TicketsController@index','hiring') }}?savesearch=1&assigned_to%5B%5D={{\App\Helpers\CustomHelper::getgeneral("group_id","job_application")}}&subject=&advancedstatus%5B%5D=open&advancedstatus%5B%5D=in_process&advancedstatus%5B%5D=completed&updated_at=">Hiring Ticket</a>	
                                </li>	
                            @else	
                                <li class="breadcrumb-item">	
                                    <a class="" href="{{ URL::action('Admin\\TicketsController@index') }}">Tickets</a>	
                                </li>	
                            @endif
                            <li class="breadcrumb-item active tickets-breadcrumb"><span class="trunmsg">{{ $ticket->default_subject }}</span></li>
                            <li class="breadcrumb-star"><input class="star star-position breadcrumb_star  hireitem-star {{ in_array($ticket->id, $bookmark_ids) ? 'starchecked':'' }}  bookmark-star"  type="checkbox" title="Bookmark this ticket" onclick="bookmarkThisActivity({{ $ticket->id }}, 'ticket')" value="{{ $ticket->id }}" id="bmticket{{ $ticket->id }}" {{ in_array($ticket->id, $bookmark_ids) ? '':'checked' }} ></li>
                            {{-- @if($ticket->status == 'closed') --}}
                            <li class="breadcrumb-item active tickets-breadcrumb closedTag"><span style="color: red" class="closedtag {{$ticket->status == 'closed' ? '' :'hiddenbtn' }}">CLOSED TICKET</span></li>
                            {{-- @endif --}}
                        </ol>
                    </div>
                </div> 
            </div> 
        </div>
        @if($ticket->ticket_type == 'hiring')
        <div class="container-fluid hire-iconbar">
            <div class="row hire-icon-div">
                <div class="col hiring-shorticons">
                    <form action="" method="get" class="hiring_form">
                        <ul class="list-unstyled d-flex my-3 mx-2 candidate_form">
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Hiring Activities" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\ActivityController@hiringactivity'); ?>"><img src="{{ url('img/hiring-activity.svg') }}" class="customerwarm" title="Hiring Activities"></a>
                            </li>
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Candidates" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\CandidateController@index'); ?>?savesearch=1&task_all_name_h=0&user_id=&task_all_job_h=0&additional_comment=&status%5B0%5D=attempt-1&status%5B1%5D=attempt-2&status%5B2%5D=attempt-3&status%5B3%5D=new&status%5B4%5D=interview-completed&status%5B5%5D=set-up-interview&status%5B6%5D=setup-phone-screen&status%5B7%5D=phone-screen-completed&status%5B8%5D=completed-questionnaire&status%5B9%5D=reapplied&status%5B10%5D=work-interview-completed&status%5B11%5D=questionnaire-waiting-for-c.response&status%5B12%5D=phone-screen-waiting-for-c.response&status%5B13%5D=work-interview-waiting-for-c.response&status%5B14%5D=interview-waiting-for-c.response&status%5B15%5D=setup-work-interview&task_all_createdat_h=0&created_at=&updated_at=&updatedat_sort=desc"><img src="{{ url('img/candidates.svg') }}" class="customerwarm" title="Candidates"></a>
                            </li>
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Hiring Jobs" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\JobPositionController@index'); ?>?&location_filter%5B%5D=Coimbatore%2C+TN%2C+India&location_filter%5B%5D=Vancouver%2C+WA%2C+USA"><i class="icon-briefcase" ></i><img src="{{ url('img/jobs.svg') }}" class="customerwarm" title="Jobs"></a>
                            </li>
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Hiring Tickets" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\TicketsController@index','hiring'); ?>?savesearch=1&assigned_to%5B%5D=&assigned_to%5B%5D=76&assigned_to%5B%5D=77&assigned_to%5B%5D=80&assigned_to%5B%5D=70&assigned_to%5B%5D=84&assigned_to%5B%5D=68&assigned_to%5B%5D=81&subject=&advancedstatus%5B%5D=open&advancedstatus%5B%5D=in_process&advancedstatus%5B%5D=completed&updated_at="><img src="{{ url('img/hiring-tickets.svg') }}" class="customerwarm" title="Hiring Tickets"></a> 
                            </li>
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Hiring Documents" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\CandidateController@documentindex'); ?>?&location_filter%5B%5D=cbe&location_filter%5B%5D=Coimbatore%2C+TN%2C+India&location_filter%5B%5D=Part-Time&location_filter%5B%5D=Vancouver%2C+WA%2C+USA"><img src="{{ url('img/documents.svg') }}" class="customerwarm" title="Hiring Documents"></a> 
                            </li>
                            <li class="d-flex align-items-center justify-content-center mr-2">
                                <a title="Hiring Text Messages" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\TwilioController@textMessages','hiring'); ?>"><img src="{{ url('img/text-msg.svg') }}" class="customerwarm" title="Hiring Text Messages"></a>
                            </li>
                            @if(in_array('opt_in_opt_out', $menuPrivilages))
                                <li class="d-flex align-items-center justify-content-center">
                                    <a title="Hiring Activities" class="click-call client-action edituserbutton" target="_blank" href="<?php echo URL::action('Admin\\OptinOptoutController@hiring'); ?>"><img src="{{ url('img/text-msg-subscription.svg') }}" class="customerwarm" title="Hiring Text Message Subscription"></a>
                                </li>
                                @endif
                        </ul>  
                        </div>
                        
                            <div class="col candidate-searchbox candidate position-static d-flex">
                                <button type="button" class="button searchinputicon"><i class="icon-form icon-partners"></i></button> 
                                <input id="searchInputcandidate" class="form-control" type="text" name="search" placeholder="Hiring Search.." onkeyup="searchcandidateByTerm(this.value)">                                  
                            </div>
            
                            <div class="col hiring-txt-sub act-log-searchpanel cus-text">
                            </div>  
                                 
                            <div id="candidate_search_results" class="candidate-listdetails"></div>
                    </form>
            </div>
        </div>
        @endif
        <div class="title-container customer-fixed-header customer-head-view secondBar hiring-secbar {{ $ticket->ticket_type == 'internal' ? 'has-internal-secondbar' : 'has-customer-secondbar' }} ">
            <div class="primary-info">
                <div class="left">
                    <div class="top">
                        @if($user)                    
                        @php
                            $userencode = \App\Helpers\CustomHelper::userEncode($user->id);
                        @endphp
                        @if($ticket->is_job_applicant == 1)	
                        <h3  class="clear-btn">	
                            {{ $user->first_name }} {{ $user->last_name }} 	
                        @else
                        <h3  class="clear-btn">
                            @if($user->isPartner)
                                <a href="{{ URL::action('Admin\\PartnerController@view', [$userencode]) }}" title='{{ $user->name ? "".$user->name."( ".$user->nick_name." )"  : "" }}'> 
                            @else
                                <a href="{{ URL::action('Admin\\CustomerController@view', [$userencode]) }}" title='{{ $user->name ? "".$user->name."( ".$user->nick_name." )" : "" }}'> 
                            @endif
                            {{ $user->name }} 
                             <span class="nick_name">{{ $user->nick_name ? "(".$user->nick_name.")" : "" }}</span></a></h3>
                             @endif
                        <ul>
                            @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_voice_call") == 1)
                            <li>
                                @if(in_array('voice_call_history', $menuPrivilages))
                                <a title="Call" class="click-call client-action call-customer-button" href="javascript:;" onclick="setTwilioCallData('{{ $user->twiliophonenumber }}' ,'{{ $user->name }}')" data-toggle="modal" data-target="#callTwilio-modal">
                    <img class="phone_icon" src="{{ url('adminasset/img/phone.svg') }}" style=" width: 25px;"></a>
                                @endif
                            </li>
                            @endif
                            @if($ticket->is_job_applicant == 1)
                            <li  class="customer-breadcramb">
                                <a title="Edit" class="click-call client-action edituserbutton" href="{{ URL::action('Admin\\CandidateController@edit', $user->id) }}" >
                                <i class="fa fa-pencil" aria-hidden="true"></i></a>
                            </li>
                            @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_hiring_text") == 1)
                             <li>
                                <a title="Send Message"  class="click-msg" href="{{ URL::action('Admin\\DashboardController@gotoCandidateMessage', [ $user->id, 'user_number' => $user->phone_number_stripped, 'for=hiring']) }}" target="_blank"><img src="{{ url('adminasset/img/mm/mm-sms.svg') }}" style="width: 25px;"></a>
                             </li>
                             @endif
                             {{-- <li>
                                <a target="_blank" href="{{ URL::action('Admin\\TwilioController@createMessage', ['header_user_id' => $user->id, 'contact_from'=>'candidate']) }}" class="contactlist_plus topheader">
                                <img class="maps" src="{{ url('adminasset/img/mm/mm-share.svg') }}" width="25" />
                                </a>
                            </li> --}}
                            @else
                            <li>
                                @if($user->user_type == 'rental-owner-lead' )
                                    <a title="Edit" class="click-call client-action edituserbutton" href="{{ URL::action('Admin\\LeadController@edit', [$userencode, 'from=lead' ]) }}" >
                                @elseif($user->isPartner) 
                                    <a title="Edit" class="click-call client-action edituserbutton" href="{{ URL::action('Admin\\PartnerController@edit', $userencode) }}" >
                                @else
                                 <a title="Edit" class="click-call client-action edituserbutton" href="{{ URL::action('Admin\\CustomerController@edit', $userencode) }}" >
                                 @endif
                                <i class="fa fa-pencil" aria-hidden="true"></i></a>
                            </li>
                            @endif	
                            @if($ticket->is_job_applicant != 1)
                            <!-- <li>
                                <a title="Impersonate" target="_blank" href="{{ route('impersonate', $user->id) }}" class="customer-view"><i class="fa fa-loginas" aria-hidden="true"> <small></small> </i></a>
                            </li> -->
                            {{-- <li>
                                <a target="_blank" href="{{ URL::action('Admin\\TwilioController@createMessage', ['header_user_id' => $user->id, 'contact_from'=>'user']) }}" class="contactlist_plus topheader">
                                <img class="maps" src="{{ url('adminasset/img/mm/mm-share.svg') }}" width="25" />
                                    </a>
                            </li> --}}
                            @endif
                        </ul>
                        @endif
                    </div>
                </div>
                <div class="right">
                    <ul>
                        <li> <a title="Expand all" href="javascript:;" onclick="allExpandCollapse()" id="expand_all_collapse_all"><span>Expand all</span></a>  </li>
                        <li><a title="Activity" href="javascript:;" onclick="focusActivity();"><span><i><img width="20" src="{{ url('adminasset/img/navIcon/activities-black.svg') }}"></i><small>Activity </small> ({{ $activitiesCount }})</span></a></li>
                        <li><a title="Task List" href="javascript:;" onclick="focusChecklist();"><span><i><img width="20" src="{{ url('adminasset/img/navIcon/task-black.svg') }}"></i><small>Task list </small>({{ $checklists  }})</span></a></li>
                        <li><a title="Mails" href="javascript:;" onclick="focusReply();"><span><i><img width="20" src="{{ url('adminasset/img/navIcon/mail-black.svg') }}"></i><small>Mails</small> ({{ $ticketHistoriesCount }})</span></a></li>
                        @if(in_array('text_messages', $menuPrivilages) && $user)
                        <li>
                            @if($ticket->ticket_type == 'internal')
                            <a title="Text Message" class="" href="javascript:;" onclick="setTwilioData('{{ $ticket->customer->phone_number }}' ,{{ $ticket->customer->id }}, {{ $ticket->customer->id }}, 'customers');gotoLastSMS();" data-toggle="modal" data-target="#smsTwilio-modal" >
                            @else
                            <a title="Text Message" class="" href="javascript:;" onclick="focusSmS(); gotoLastSMS();" >
                            @endif
                            <span><i><img width="20" src="{{ url('adminasset/img/navIcon/textmessage-black.svg') }}"></i><small>Text Messages</small> ({{ count($twilioMessages) }})</span></a></li>
                        @endif
                        <li><a title="Notes" href="javascript:;" onclick="focusNotes()" ><span><img src="{{ url('adminasset/img/navIcon/notes-black.svg') }}"><small>Notes</small> ({{ $notesCount }})</span></a> </li>
                        @if($ticketassignTo->id == 33 || $ticketassignTo->id == 41 || $ticketassignTo->id == 40 || $ticketassignTo->id == 50 ) 
                            <li title="Contact List" class="contact_list"><a href="javascript:;" onclick="focusContacts()" ><span><img src="{{ url('adminasset/img/navIcon/contact-black.svg') }}"><small>Contact List</small> ({{ count($ticket->contacts) }})</span></a> </li>
                        @endif
                    </ul>
                </div>
            </div>
        </div>
    </div>
   
    <div class="ticketview-content-startpanel {{ $ticket->ticket_type == 'hiring' ? 'hire-ticketpanel' : '' }}  ">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-md-12">
                    @include('layouts.admin.alert-success')
                    <div class="content-container creattickets-form-container">
                        <input type="hidden" name="twilio_ticket_id" id="twilio_ticket_id" value="{{ $ticket->id }}">
                        <div class="view-notes-container tickets-view">
                            <div class="view-notes-panel">
                                <h4 class="cus-table-header cursor-pointer" id="ec_ticket_container_header" onclick="CEToggle('ec_ticket_container')" >
                                    <div class="icon-title">
                                        <img class="black icon-title-icon h-fix" width="35" src="{{ url('adminasset/img/sidebaricon/ticket-black.svg') }}">
                                        <img class="white icon-title-icon h-fix" width="35" src="{{ url('adminasset/img/sidebaricon/ticket-white.svg') }}">
                                        <span class='text-wrap d-flex align-items-center'>SUBJECT :
                                            <span class="count-wrap subject ml-1"> {{ $ticket->subject }}</span>
                                        </span>
                                    </div>
                                    <span class="icon-title-span">
                                         
                                    @if( (Auth::user()->id == $ticket->creator_id || Auth::user()->isAdmin || \App\Helpers\CustomHelper::ticketeditaccess(Auth::user()->id) > 0) && $ticket->status != 'closed' )
                                        <a href="javascript:;" onclick="editorById('ticket_edit_body')"  class="mr-1 convert-as-ticket mark-as-unread" data-toggle="modal" data-target="#ticketEdit-modal" >Edit</a>
                                    @endif
                                    <a href="{{ URL::action('Admin\\TicketsController@create', ['ticket_id='.$ticket->id] ) }}" class="mr-1 convert-as-ticket mark-as-unread" target="blank">Copy</a>
                                     @if($ticket->status != 'closed')
                                        <a href="{{ URL::action('Admin\\TicketsController@markasunread', $ticket->id ) }}" class="mr-1 convert-as-ticket mark-as-unread">Mark as unread</a>
                                    @endif


                                <span class="ticket-number-class tck-wrp">Ticket Number :  <strong class="ticket-number"> {{ ($ticket->ticket_type) ? ucfirst($ticket->ticket_type[0])  : "" }}{{ $ticket->id }} </strong></span></span></h4>
                                <!--    <div class="row"> row start-->
                            <div class="display-none" id="ec_ticket_container">
                                <div class="view-notes-panel-content">
                                    <div class="col-12 col-lg-12 top-border-panel">
                                        <div class="content">
                                            <div class="form-group">
                                                <label class="col-form-label">Ticket Type : <p class="form-control-static">{{ ucfirst($ticket->ticket_type) }}</p> </label>
                                            </div>
                                            @if($ticket->ticket_type == 'partner' && $ticket->customer)
                                            <div class="form-group">
                                                <label class="col-form-label">Customer : <p class="form-control-static">{{ ucfirst($ticket->customer->name) }}</p> </label>
                                            </div>
                                            @endif
                                            <div class="form-group">
                                                <label class="col-form-label">Ticket Email : <p class="form-control-static">{{ $ticket->email_token }}</p></label>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-form-label">Created : <p class="form-control-static">{{ ($ticketcreator) ? $ticketcreator->name : '-' }} - {{ \App\Helpers\CustomHelper::dateFormatUS("$ticket->created_at") }}</p></label>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-form-label">Activity : <p class="form-control-static">{{ $lastactivity->activitybasedcreateby_users}} - {{ \App\Helpers\CustomHelper::dateFormatUS($lastactivity->updated_at) }}</p></label>
                                            </div>
                                            <div class="form-group">
                                                @php
                                                $ticketLast = ($ticketHistories) ? $ticketHistories->last() : $ticket;
                                                @endphp
                                                {{-- @if($ticket->updatedBy)
                                                <label class="col-form-label">Last Email : <p class="form-control-static">{{ ($ticket->updatedBy) ? $ticket->updatedBy->name : '' }} - {{ $ticket->updatedAtFormated }} </p></label>
                                                @else --}}
                                                <label class="col-form-label">Last Email : <p class="form-control-static">{{$lastemail->emailbasedcreateby_users}} - {{ \App\Helpers\CustomHelper::dateFormatUS($lastemail->created_at) }} </p></label>
                                                {{-- @endif --}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @php
                                        $ticketDetail = $ticketHistories->first();

                                @endphp
                                <div class="view-notes-panel-header openblank">
                                    <div class="col-12">
                                        <div class="row">
                                            <div class="col-lg-12 col-12">
                                                <div class="form-group">
                                                    <label class="col-form-label tdesc purgex less" onclick="toggleTicketDescription()"><span class="col-form-labelspan">Ticket Description : </span><span class="ticket-top-stripped-content"> {!! strip_tags($ticketDetail->body,'<a>') !!} </span></label>
                                                    <button class="purgex less" onclick="toggleTicketDescription()"></button>
                                                </div>
                                                <div class="pureyad display-none">
                                                    @if($ticketDetail)
                                                    <p class="ticket-top-full-content"> {!! nl2br($ticketDetail->body) !!} </p>
                                                    @if($ticketDetail->emailAttachments != "")
                                                    @foreach($ticketDetail->emailAttachments as $attachment)
                                                    <p class="attachment-ticket">
                                                        <a href="{{ route('downloademail', $attachment->id) }}">
                                                                                    <i class="fa fa-paperclip"></i>   {{ last(explode("/",$attachment->attachment)) }}
                                                        </a>
                                                        @if($ticket->is_job_applicant != 1)
                                                         (<a href="{{ URL::action('Admin\\DocumentController@create', ['ticket_id='.$ticket->id, 'attachment_id='.$attachment->id, 'with_image=1']) }}" class="a-site-color">Move to documents</a>)
                                                         @endif
                                                    </p>
                                                    @endforeach
                                                    @endif
                                                    @endif
                                                </div>
                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="view-notes-panel-content gray-strip">
                                    <div class="col-12 col-lg-12">
                                        <div class="content ">
                                            @php
                                            $propeties = ($ticket->customer) ? $ticket->customer->childsAll : '';
                                            $assignedProperty = $ticket->assignedchild;
                                            $buyerGroup = "";
                                            $buyerGroupUsers = [];
                                            if($assignedProperty) {
                                               $buyerGroup =  $assignedProperty->buyerGroup;
                                               $buyerGroupUsers = $buyerGroup->users;
                                            }
                                            @endphp
                                            @if($ticket->is_job_applicant != 1)
                                            <div class="form-group panel compy">
                                                <div>
                                                <label class="col-form-label">Children : </label>
                                                <p class="form-control-static" id="cc_property_id_value" title="{{ ($ticket->assignedchild) ? ($ticket->assignedchild->child_name.' '.$ticket->assignedchild->child_lastname) : '-' }}">
                                                    <span id="propertyval" class="display-name">{{ ($assignedProperty) ? ($assignedProperty->child_name.' '.$assignedProperty->child_lastname) : '-' }} </span>
                                                    <span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('property_id')"><i class="fa fa-pencil"></i></span>
                                                </p>
                                                </div>
                                                <select class="send-pma-users display-none default-dropdown pencil_toggle" name="property_id" id="property_id" onchange="changeValue(this.value, 'cc_property_id')">
                                                    <option value="0">Select</option>
                                                    @if($propeties)
                                                    @foreach($propeties as $propety)
                                                    <option value="{{ $propety->id }}" id="property_{{ $propety->id }}" {{ $propety->id == $ticket->child_id  ? 'selected' : '' }} data-name="{{ ($propety->child_name.' '.$propety->child_lastname) }}"> {{ ($propety->child_name.' '.$propety->child_lastname)}}</option>
                                                    @endforeach
                                                    @endif
                                                </select>
                                            </div>
                                            @endif
                                            <div class="form-group panel">
                                                <div>
                                                <label class="col-form-label">Group: </label>
                                                <p class="form-control-static" id="cc_assigned_to_value" title="{{ ($ticketassignTo) ? $ticketassignTo->name : '-' }}"> <span id="groupval" class="display-name">{{ ($ticketassignTo) ? $ticketassignTo->name : '-' }} </span> @if($ticket->is_job_applicant != 1)<span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('assigned_to')"><i class="fa fa-pencil"></i>@endif</span></p>
                                                </div>
                                                <select class="send-pma-users  display-none default-dropdown pencil_toggle" name="assigned_to" id="assigned_to" onchange="changeValue(this.value, 'cc_assigned_to')">
                                                    @if($customers->count() > 0)
                                                    @foreach(\App\Helpers\CustomHelper::getGroupsPermissionQuery(['id', 'name']) as $group)
                                                    <option value="{{ $group->id }}" id="group{{ $group->id }}" {{ $ticket->assigned_to == $group->id  ? 'selected' : '' }} data-name="{{ $group->name }}">{{ $group->name }}</option>
                                                    @endforeach
                                                    @endif
                                                </select>
                                            </div>
                                            <div class="form-group panel">
                                                <div>
                                                    <label class="col-form-label">Staff: </label>
                                                    <p class="form-control-static" id="cc_assigned_to_staff_value" title="{{ ($ticket->assignToStaff) ? $ticket->assignToStaff->name : '-' }}"><span id='staffval'  class="display-name">{{ ($ticket->assignToStaff) ? $ticket->assignToStaff->name : '-' }} </span> <span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('assigned_to_staff')"><i class="fa fa-pencil"></i></span></p>
                                                </div>
                                                <select class="send-pma-users display-none default-dropdown pencil_toggle" name="assigned_to_staff" id="assigned_to_staff" onchange="changeValue(this.value, 'cc_assigned_to_staff')">
                                                    @if($users->count() > 0)
                                                    <option value="">Select</option> 
                                                    @foreach($users as $user)
                                                    <option value="{{ $user->id }}" id="user{{ $user->id }}" {{ $ticket->assigned_to_staff  == $user->id  ? 'selected' : '' }} data-name="{{ $user->name }}">{{ $user->name }}</option>
                                                    @endforeach
                                                    @endif
                                                </select>
                                            </div>
                                            <div class="form-group panel">
                                                <div>
                                                <label class="col-form-label">Priority : </label>
                                                <p class="form-control-static has-color-{{  $ticket->priority }}" id="cc_priority_value"> <span id="priorityval" class="display-name">{{  ucfirst($ticket->priority) }}  </span><span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('priority')"><i class="fa fa-pencil"></i></span></p>
                                                </div>
                                                <select class="send-pma-users display-none default-dropdown pencil_toggle" name="priority" id="priority" onchange="changeValue(this.value, 'cc_priority')">
                                                    <option value="low" id="low" {{ $ticket->priority == 'low'  ? 'selected' : '' }} data-name="Low">Low</option>
                                                    <option value="medium" id="medium" {{ $ticket->priority == 'medium'  ? 'selected' : '' }} data-name="Medium">Medium</option>
                                                    <option value="high" id="high" {{ $ticket->priority == 'high'  ? 'selected' : '' }} data-name="High">High</option>
                                                    <option value="showstopper" id="showstopper" {{ $ticket->priority == 'showstopper'  ? 'selected' : '' }} data-name="Showstopper">Showstopper</option>
                                                </select>
                                            </div>
                                            <div class="form-group panel">
                                                <div>
                                                <label class="col-form-label">Status :</label>
                                                <p class="form-control-static" id="cc_status_value"><span id="statusval" class="display-name">{{ @config('toptech.ticket_status')[$ticket->status] ? config('toptech.ticket_status')[$ticket->status] : ucfirst(str_replace("_", "",$ticket->status))  }} </span> <span class="edit-icon" onclick="showSelect('status')"><i class="fa fa-pencil"></i></span> </p>
                                                </div>
                                                <select class="send-pma-users display-none default-dropdown pencil_toggle" name="status" id="status" onchange="changeValue(this.value, 'cc_status')">
                                                    <option value="open" id="open" {{ $ticket->status == 'open'  ? 'selected' : '' }} data-name="Open">Open</option>
                                                    <option value="in_process" id="in_process" {{ $ticket->status == 'in_process'  ? 'selected' : '' }} data-name="In-Process">In-Process</option>
                                                    @if(($ticket->assigned_to) == 14 )   
                                                    <option value="Completed (Staging)" id="Completed (Staging)" {{ $ticket->status == 'Completed (Staging)'  ? 'selected' : '' }} data-name="Completed (Staging)">Completed (Staging)</option>
                                                    <option value="Validated (Staging)" id="Validated (Staging)" {{ $ticket->status == 'Validated (Staging)'  ? 'selected' : '' }} data-name="Validated (Staging)">Validated (Staging)</option>
                                                    @endif
                                                    <option value="completed" id="completed" {{ $ticket->status == 'completed'  ? 'selected' : '' }} data-name="Completed">Completed</option>
                                                    <option value="closed" id="closed" {{ $ticket->status == 'closed'  ? 'selected' : '' }} data-name="Closed">Closed</option>
                                                </select>
                                            </div>
                                            @if($ticket->is_job_applicant != 1)
                                            @if($ticket->ticket_type != 'customer')
                                            @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_ticketSummary_class") == 1)
                                                <div class="form-group panel">
                                                    <div>
                                                    <label class="col-form-label">Class :</label>
                                                    <p class="form-control-static" id="cc_class_value"><span id="classval" class="display-name">{{  ($ticket->class) ? ucfirst($ticket->class) : '-'  }} </span> <span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('class')"><i class="fa fa-pencil"></i></span> </p>
                                                    </div>
                                                    <select class="send-pma-users display-none default-dropdown pencil_toggle" name="class" id="class" onchange="changeValue(this.value, 'cc_class')">
                                                        <option value="">Select</option>
                                                        <option value="bug" id="bug" {{ $ticket->class == 'bug'  ? 'selected' : '' }} data-name="Bug">Bug</option>
                                                        <option value="enhancement" id="enhancement" {{ $ticket->class == 'enhancement'  ? 'selected' : '' }} data-name="Enhancement">Enhancement</option>
                                                        <option value="feature" id="feature" {{ $ticket->class == 'feature'  ? 'selected' : '' }} data-name="Feature">Feature</option>
                                                        <option value="question" id="question" {{ $ticket->class == 'question'  ? 'selected' : '' }} data-name="Question">Question</option>
                                                    </select>
                                                </div>
                                            @endif
                                            @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_ticketSummary_version") == 1)
                                                <div class="form-group panel">
                                                    <div>
                                                    <label class="col-form-label">Version :</label>
                                                    <p class="form-control-static" id="cc_version_value"><span id="versionval" class="wrap display-name">{{  ($ticket->version) ? $ticket->version : '-'  }} </span> <span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('version')"><i class="fa fa-pencil"></i></span> </p>
                                                    </div>
                                                    <input type="text" class="form-control display-none pencil_toggle" name="version" id="version" value="{{ $ticket->version }}" onchange="changeValue(this.value, 'cc_version')" >
                                                </div>
                                            @endif
                                            @endif
                                            @endif
                                            <div class="form-group panel">
                                                <div>
                                                    <label class="col-form-label">CC: </label>
                                                    <p class="form-control-static" id="cc_emails_value" title=""><span id="ccval" class="display-name  wrap">{{ ($ticketLast) ? $ticketLast->cc : '-' }} </span> <span class="edit-icon viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" onclick="showSelect('cc_emails')"><i class="fa fa-pencil"></i></span></p>
                                                </div>
                                                <input type="text" class="form-control display-none pencil_toggle" name="cc_emails" id="cc_emails" value="{{ ($ticketLast) ? $ticketLast->cc : '-' }}" onchange="changeValue(this.value, 'cc_emails')">
                                            </div>
                                            <div class="form-group panel ticket-access">
                                                <div>
                                                <label class="col-form-label">Access : </label>
                                                </div>
                                                @php
                                                $count=count($accessibleUserIds);
                                                $i=0;
                                                $accessibleUserval="";
                                                    for($i=0;$i<$count;$i++ ) {
                                                        $accessibleUserval.=$accessibleUserIds[$i];
                                                        $accessibleUserval.=','; 
                                                    }
                                                @endphp
                                                <select class="send-pma-users select-two-dd ticketaccess" name="accessible_users[]" id="accessible_users" multiple="multiple" onchange="changeValue(this.value, 'cc_accessible_users')" {{$ticket->status == 'closed' ? 'disabled' :'' }}>
                                                    @if( count($accessibleUsers) > 0)
                                                        @foreach($accessibleUsers as $accessibleUser)
                                                             <option value="{{ $accessibleUser->id }}" {{ in_array($accessibleUser->id,  $accessibleUserIds) ? 'selected' : '' }}  >{{ $accessibleUser->nameWithRole }}</option>
                                                        @endforeach                                    
                                                    @endif
                                                </select>
                                            </div>
                                            <!-- @if($ticket->ticket_type == 'customer')
                                            <div class="form-group panel ticket-access">
                                                <div>
                                                <label class="col-form-label">Customer Access : </label>
                                                </div>
                                                @php
                                                $count=count($accessibleUserIds);
                                                $i=0;
                                                $accessibleUserval="";
                                                    for($i=0;$i<$count;$i++ ) {
                                                        $accessibleUserval.=$accessibleUserIds[$i];
                                                        $accessibleUserval.=','; 
                                                    }
                                                @endphp
                                                <select class="send-pma-users select-two-dd ticketaccess" name="cus_accessible_users[]" id="cus_accessible_users" multiple="multiple" onchange="changeValue(this.value, 'cc_cus_accessible_users')" {{$ticket->status == 'closed' ? 'disabled' :'' }}>
                                                    @if( count($cusaccessibleUsers) > 0)
                                                        @foreach($cusaccessibleUsers as $cusaccessibleUser)
                                                             <option value="{{ $cusaccessibleUser->id }}" {{ in_array($cusaccessibleUser->id,  $accessibleUserIds) ? 'selected' : '' }}  >{{ $cusaccessibleUser->name }}</option>
                                                        @endforeach                                    
                                                    @endif
                                                </select>
                                            </div>
                                            @endif -->
                                            <div class="form-group panel last has-btn update-cancel-btnGroup">
                                                <button onclick="updateTicketValues('not-notify')" class="btn-blue disabled topupdatebuttonforticket" id="topupdatebuttonforticket_not">Update</button>
                                                <button onclick="updateTicketValues('notify')" class="btn-blue disabled topupdatebuttonforticket and-notify " id="topupdatebuttonforticket">Update and Notify</button>
                                                <button onclick="cancelupdate('{{$assignedProperty->addressWithUnit}}','{{$ticket->assignedProperty->id}}','{{$ticketassignTo->name}}','{{$ticketassignTo->id}}','{{$ticket->assignToStaff->name}}','{{$ticket->assignToStaff->id}}','{{$ticket->priority}}','{{$ticket->status}}','{{$ticket->class}}','{{$ticket->version}}','{{$ticketLast->cc}}','{{$accessibleUserval}}')" class="btn-blue disabled topupdatebuttonforticket cancel" id="cancelupdate">Cancel</button>
                                                <p class="alert-success display-none " style="margin-top: 10px; text-align: center;" id="alert-success-update">Updated!.</p>
                                            </div>
                                        </div>
                                        @if(Auth::user()->isAdmin || ( \App\Helpers\CustomHelper::ticketeditaccess(Auth::user()->id) > 0 ) )
                                        <div class="form-group hideticketid">
                                            <label class="col-md-5 modal-label" for="hide_ticketid"> 
                                                <input type="checkbox" name="hide_ticketid" id="hide_ticketid" value="{{ $ticket->hide_ticketid}}" {{ $ticket->hide_ticketid == 1 ? 'checked' : '' }}> 
                                                Hide ticket ID in notification email subject
                                            </label>
                                        </div> 
                                        @else
                                            <input type="hidden" name="hide_ticketid" id="hide_ticketid" value="{{ $ticket->hide_ticketid}}">           
                                        @endif  
                                    </div>
                                </div>
                                </div>
                                <!-- </div> row end-->
                            </div>
                        </div>
                    </div>

 <!-- QTO -->
                <?php 
                if($ticket->assigned_to != 0 && $ticket->is_default_qto == 1) {
                if($ticket->assigned_to == 30) {
                // $tcustomer = $ticket->customer;
                $tcustomer = $ticket->customer ? $ticket->customer : App\Models\User::find(1194);
                  $rmlsViews = $tcustomer->rmlsViews();
                  $rmlsFavs = $tcustomer->rmlsFavs();
                  $rmlsSearchs = $tcustomer->rmlsSearchs();
                  $rmlsTours =  $tcustomer->rmlsTours();
                $reasignTCount = $ticket->homeSearchReasign();
                $totalCount = count($rmlsViews) + count($rmlsFavs) + count($rmlsSearchs) + count($rmlsTours);
                ?>
                <div class="form-container content-container chat-panel" id="qto_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_relatednotes">
                            <div class="cus-table-header cursor-pointer" id="ec_qtocontainer_header" onclick="CEToggle('ec_qtocontainer')" >
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/home-search-black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/home-search-white.svg') }}">
                                    <h2>Home Search ({{ $totalCount }})</h2>
                                </div>                                
                            </div>
                            @php
                          $type = 'ticket';
                          $typeId = $ticket->id;
                          @endphp
                          <div class="display-none" id="ec_qtocontainer" >
                            <table class="mt-4">
                                <tr>
                                    <td>
                                        <span  class="{{ count($rmlsViews) > 0 ? 'customer-lists' : 'paading-notes' }}">
                                              <a href="javascript:;"  class="default-clr">Views ({{ count($rmlsViews) }})</a>
                                              @if(count($rmlsViews) > 0)
                                              <ul class="hover-popup mobile-hide">
                                                @foreach($rmlsViews as $index => $rmlsView)
                                                <li>
                                                  {{ $index+1 }}. <a href="{{ $rmlsView->log }}" target="_blank">{{  $rmlsView->FullStreetAddress }}({{ $rmlsView->total_count }})</a>
                                                </li>
                                                @endforeach
                                              </ul>
                                              @endif
                                            </span>
                                    </td>
                                    <td>
                                        <span  class="{{ count($rmlsFavs) > 0 ? 'customer-lists' : 'paading-notes' }}">
                                          <a href="javascript:;"  class="default-clr">Favorites ({{ count($rmlsFavs) }})</a>
                                          @if(count($rmlsFavs) > 0)
                                          <ul class="hover-popup mobile-hide">
                                            @foreach($rmlsFavs as $index => $rmlsFavs)
                                            @php
                                            $hrefUrlA = URL::action('HomeSearch\\HomeSearchController@listing', [$rmlsFavs->County, $rmlsFavs->State, $rmlsFavs->slug, $rmlsFavs->ListingID]);
                                            @endphp
                                            <li>
                                              <a href="{{ $hrefUrlA }}"> {{ $index+1 }}. {{  $rmlsFavs->FullStreetAddress }}</a>
                                            </li>
                                            @endforeach
                                          </ul>
                                          @endif
                                        </span>
                                    </td>
                                    <td>
                                        <span  class="{{ count($rmlsSearchs) > 0 ? 'customer-lists' : 'paading-notes' }}">
                                          <a href="javascript:;"  class="default-clr">Searches ({{ count($rmlsSearchs) }})</a>
                                          @if(count($rmlsSearchs) > 0)
                                          <ul class="hover-popup mobile-hide">
                                            @foreach($rmlsSearchs as $index => $rmlsSearch)
                                            <li>
                                              {{ $index+1 }}. <a href="{{ $rmlsSearch->url }}" target="_blank">{{  $rmlsSearch->name }}</a>
                                            </li>
                                            @endforeach
                                          </ul>
                                          @endif
                                        </span>
                                    </td>
                                    <td>
                                        <span  class="{{ count($rmlsTours) > 0 ? 'customer-lists' : 'paading-notes' }}">
                                          <a href="javascript:;"  class="default-clr">Tours ({{ count($rmlsTours) }})</a>
                                          @if(count($rmlsTours) > 0)
                                          <ul class="hover-popup mobile-hide">
                                            @foreach($rmlsTours as $index => $log)
                                            @php
                                            $hrefT = "";
                                            if($log->eloquent == 'rmls_property' && $log->eloquent_id != '' && !in_array($log->log_type, ['search', 'listing_visit'])) {
                                                $rmls = $log->rmls($log->eloquent_id);
                                                if($rmls) {
                                                    $hrefT = URL::action('HomeSearch\\HomeSearchController@listing', [$rmls->County, $rmls->State, $rmls->slug, $rmls->ListingID]);
                                                }
                                            }
                                            if($log->log_type == 'saved_search') {
                                                $meta = (array) json_decode($log->meta);
                                                if(@$meta['url']) {
                                                    $hrefT = $meta['url'];
                                                }
                                            }
                                            if($hrefT == "") {
                                                $sX = explode(",", explode("#", $log->log)[1]);
                                                if(count($sX) == 1) {
                                                  $rmls = $log->rmls(@$sX[0]);
                                                  if($rmls) {
                                                    $hrefT = URL::action('HomeSearch\\HomeSearchController@listing', [$rmls->County, $rmls->State, $rmls->slug, $rmls->ListingID]);
                                                  }
                                               }
                                            }
                                            @endphp
                                            <li>

                                               @if($hrefT != "")
                                                  <a href="{{ $hrefT }}" target="_blank">{{ $index+1 }}. {{  @explode(":",$log->log)[1] }}</a>
                                               @else
                                                <a>{{ $index+1 }}. {{  @explode(":",$log->log)[1] }}</a>
                                               @endif
                                              
                                            </li>
                                            @endforeach
                                          </ul>
                                          @endif
                                        </span>
                                    </td> 
                                    <td>
                                        <button class="advanced-search-a {{ $reasignTCount == 0 ? 'disabled' : '' }}" 
                                        onclick="showuserbstickets('{{ $ticket->id }}', '{{ $tcustomer->id }}')">Redesignate</button>
                                    </td>
                                </tr>
                            </table>
                             <tr>                         
            <div class="" id="home_search_details_form">

           <form method="POST" action="{{URL::action('Admin\TicketsController@saveHomeSearchDetails')}}" id="home_search_details"  class="home-search-form" autocomplete="off">
                 {{ csrf_field() }} 
          <div class="row">
              <input type="hidden" name="creator_id" value="{{Auth::user()->id}}">
              <input type="hidden" name="ticket_id" value="{{$ticket->id}}">
 
             <div class="col-sm-4">
                <label for="status_update" class="transaction-labels">Status Update</label>
               <textarea class="form-control val" name="status_update">{{(@$home_search_details->status_update) ? $home_search_details->status_update : ''}}</textarea>
            </div>
           <div class="col-sm-4">
                <label for="offer_address" class="transaction-labels">Offer Address</label>
                 <input type="text" class="form-control val" name="offer_address" value="{{(@$home_search_details->offer_address) ? $home_search_details->offer_address : ''}}">
           </div>

          <div class="col-sm-4">
              <label for="link_to_listing" class="transaction-labels">Link to Listing</label>
              <input type="text" class="form-control val" name="link_to_listing" value="{{(@$home_search_details->link_to_listing) ? $home_search_details->link_to_listing : ''}}">
         </div>
         <div class="col-sm-4">
                <label for="pre_approval" class="transaction-labels">Pre Approval</label>
                 <input type="text" class="form-control val" name="pre_approval" value="{{(@$home_search_details->pre_approval) ? $home_search_details->pre_approval : ''}}">
           </div>
           <!-- <div class="col-sm-4">
    <label for="BA_date" class="transaction-labels">BA Date</label>
    <input type="text" class="form-control daterangepickerinputsingle1"  name="BA_date"  value="{{(@$home_search_details->BA_date && @$home_search_details->BA_date != '0000-00-00 00:00:00') ? date('m/d/Y', strtotime($home_search_details->BA_date)) : ''}}">
    </div> -->
    
 <div class="col-sm-4">
    <label for="BA_date" class="transaction-labels">BA Date</label>
    <input type="text" class="form-control daterangepickerinputsingle"  name="BA_date" value="{{(@$home_search_details->BA_date && @$home_search_details->BA_date != '0000-00-00 00:00:00') ? \App\Helpers\CustomHelper::dateFormat("$home_search_details->BA_date") : ''}}">
    </div>
          <div class="saveCancelBtnGroup" style="display:flex;">
              <button type="submit" class="form-control transition-button save-button"  name="submit">Save</button>
            <!-- <button type="reset" class="form-control transition-button"  name="cancel" onclick="resetForm('home_search_details')">Reset</button> -->
           <button type="button" class="form-control transition-button cancel-button"  name="cancel" onclick="resetForm('home_search_details')">Cancel</button>
         </div>

                           </form>

                               </div>
                               </tr>
                        @if($ticketUser)
                         <h2 class="mt-3">Customer Fields</h2>
                         <form method="POST" action="{{URL::action('Admin\TicketsController@saveCustomerDetails', $ticketUser->id)}}" id="customer_fields" class ="customer_fields_form" autocomplete="off">
                         {{ csrf_field() }}
                         <div class="row">

                            <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group {{ $errors->has('source') ? ' has-error' : '' }} ">
                                    <label for="source" class="col_label">Source</label>
                                    <select name="userprofile[source]" id="source" class="select-two-dd">
                                                <option value="">Select</option>
                                                @foreach(config('toptech.sources') as $key => $source)
                                                    <option value="{{ $key }}" {{ ($ticketUser->source ==  $source || old('source') ==  $source  ) ? 'selected' : '' }}   >{{ $source }}</option>
                                                @endforeach
                                    </select>
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-4">
                                <div class="form-group {{ $errors->has('additional_info_for_source') ? ' has-error' : '' }}  ">
                                    <label for="additional_info_for_source">Additional info for source</label>
                                    <input type="text" class="form-control" id="additional_info_for_source"  placeholder="Additional info for source"  name="userprofile[additional_info_for_source]" value="{{ old('additional_info_for_source') ? old('additional_info_for_source') :  $ticketUser->additional_info_for_source }}">
                                </div>
                            </div>

                            
                            

                            <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group {{ $errors->has('status') ? ' has-error' : '' }} ">
                                    <label for="status" class="col_label">Status</label>
                                    <select name="userprofile[status]" id="status" class="select-two-dd" onchange="toggleSnooze(this.value)">
                                                <option value="">Select</option>
                                               @foreach(config('toptech.lead_status') as $key => $status)
                                                    <option value="{{ $key }}" {{ ($ticketUser->status ==  $key || old('status') ==  $status  ) ? 'selected' : '' }}   >{{ $status }}</option>
                                                @endforeach
                                                
                                    </select>
                                    @php
                                        $snooze_date = old('snooze_date') ? old('snooze_date') : $user->snooze_date;
                                        $snoozeClass = 'display-none';
                                        if($user->status == 'snooze') {
                                            $snoozeClass = "";
                                        }
                                    @endphp
                                    @include('admin.customers._includes.snooze_date')
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group {{ $errors->has('urgency') ? ' has-error' : '' }} ">
                                    <label for="urgency" class="col_label">Priority</label>
                                    <select name="userprofile[urgency]" id="urgency" class="select-two-dd">
                                                <option value="">Select</option>
                                                @foreach(config('toptech.urgency') as $key => $urgency)
                                                    <option value="{{ $key }}" {{ ($ticketUser->urgency ==  $key || old('urgency') ==  $key  ) ? 'selected' : '' }}  >{{ $urgency }}</option>
                                                @endforeach
                                    </select>
                           
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group {{ $errors->has('first_contact_method') ? ' has-error' : '' }} ">
                                    <label for="first_contact_method" class="col_label">First contact method</label>
                                    <select name="userprofile[first_contact_method]" id="first_contact_method" class="select-two-dd">
                                                <option value="">Select</option>
                                                @foreach(config('toptech.first_contact_methods') as $key => $first_contact_method)
                                                    <option value="{{ $key }}" {{ ($ticketUser->first_contact_method ==  $key || old('first_contact_method') ==  $key  ) ? 'selected' : '' }}  >{{ $first_contact_method }}</option>
                                                @endforeach
                                    </select>
                            
                                </div>
                            </div>


                            <div class="col-sm-12 col-md-4">
                                <div class="form-group {{ $errors->has('phone_number_verify_status') ? ' has-error' : '' }} ">
                                
                                <label for="phone_number_verify_status">Phone Number Verify Status</label>
                                <select name="userprofile[phone_number_verify_status]" id="phone_number_verify_status" class="select-two-dd">
                                            <option value="0" {{ ($ticketUser->phone_number_verify_status ==  0 || old('phone_number_verify_status') ==  0) ? 'selected' : '' }}>No</option>
                                            <option value="1" {{ ($ticketUser->phone_number_verify_status ==  1 || old('phone_number_verify_status') ==  1 ) ? 'selected' : '' }} >Yes</option>
                                </select>
                                @if($user->phone_number_verify_status == 1)
                                <p>Phone number verified by <b>{{ $ticketUser->phoneVerifiedBy ? $ticketUser->phoneVerifiedBy->name : '-' }}</b></p>
                                @endif
                                </div>
                            </div>

                             <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group {{ $errors->has('timeframe') ? ' has-error' : '' }} ">
                                    <label for="timeframe" class="col_label">Timeframe</label>
                                   <select name="userprofile[timeframe]" id="timeframe" class="select-two-dd">
                                        <option value="">Select</option>
                                        @foreach(config('toptech.timeframe') as $key => $timeframe)
                                            <option value="{{ $timeframe }}" {{ ( $ticketUser->timeframe ==  $timeframe || old('timeframe') ==  $timeframe  ) ? 'selected' : '' }}  >{{ $timeframe }} </option>
                                        @endforeach
                                        </select>
                                </div>
                            </div>  
                            
                            <div class="col-sm-12 col-md-4 agent__col-input">
                                <div class="form-group">
                                    <label for="agent_id" class="col_label">Agent</label>
                                    <select class="send-pma-users select-two-dd col_input" name="userprofile[agent_id]" id="agent_id"  >
                                     <option value="0" id="" >Select</option>
                                     @foreach($agents as  $key => $agent)
                                        <option value="{{ $agent->id }}" id="{{ $agent->id }}" {{ ($ticketUser->agent_id ==  $agent->id || old('agent_id') ==  $agent->id ) ? 'selected' : '' }} >{{ $agent->name }}</option>
                                     @endforeach
                                </select>
                                </div>
                            </div>

                            <div class="col-sm-12 col-md-4">
                                <div class="form-group">
                                    <label for="created_date">Tags</label>
                                    <input type="text" class="form-control " id="tags"  placeholder="Tags"  name="userprofile[tags]" value="{{ old('tags') ? old('tags') :  $ticketUser->tags }}">
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-12">
                                <div class="saveCancelBtnGroup">
                                    <button type="submit" class="form-control transition-button save-button" onclick="hideButton('customersaveform');" name="submit">Save</button>
                                    <button type="button" class="form-control transition-button cancel-button" onclick="resetForm('customer_fields')">Cancel</button>
                                </div>
                                </div>
                        </div>
                        </form>
                        @endif
                        </div>

                        </div>

                        
                    </div>

                    
                
                <?php }
                }
                ?>
                <!-- QTO -->
                 <!-- Hiring -->
 <?php 
 if($ticket->assigned_to != 0 && $ticket->is_job_applicant == 1) {
 if($ticket->assigned_to == \App\Helpers\CustomHelper::getgeneral("group_id","job_application")) {
 // $tcustomer = $ticket->customer;
//  $tcustomer = $ticket->customer ? $ticket->customer : App\Models\User::find(1194);
//    $rmlsViews = $tcustomer->rmlsViews();
//    $rmlsFavs = $tcustomer->rmlsFavs();
//    $rmlsSearchs = $tcustomer->rmlsSearchs();
//    $rmlsTours =  $tcustomer->rmlsTours();
//  $reasignTCount = $ticket->homeSearchReasign();
//  $totalCount = count($rmlsViews) + count($rmlsFavs) + count($rmlsSearchs) + count($rmlsTours);
 ?>
 <div class="form-container content-container chat-panel" id="qto_whole_block">
     <div class="row">
         <div class="col-12 col-md-12" id="scroll_to_relatednotes">
             <div class="cus-table-header cursor-pointer" id="ec_qtocontainer_header" onclick="CEToggle('ec_qtocontainer')" >
                 <div class="icon-title">
                     <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_black.svg') }}">
                     <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_white.svg') }}">
                     <h2>Hiring</h2>
                 </div>                                
             </div>
             @php
           $type = 'ticket';
           $typeId = $ticket->id;
           @endphp
           <div class="display-none" id="ec_qtocontainer" >
             {{-- <table class="mt-4">
                 <tr>
                     <td>
                         <span  class="{{ count($rmlsViews) > 0 ? 'customer-lists' : 'paading-notes' }}">
                               <a href="javascript:;"  class="default-clr">Views ({{ count($rmlsViews) }})</a>
                               @if(count($rmlsViews) > 0)
                               <ul class="hover-popup mobile-hide">
                                 @foreach($rmlsViews as $index => $rmlsView)
                                 <li>
                                   {{ $index+1 }}. <a href="{{ $rmlsView->log }}" target="_blank">{{  $rmlsView->FullStreetAddress }}({{ $rmlsView->total_count }})</a>
                                 </li>
                                 @endforeach
                               </ul>
                               @endif
                             </span>
                     </td>
                     <td>
                         <span  class="{{ count($rmlsFavs) > 0 ? 'customer-lists' : 'paading-notes' }}">
                           <a href="javascript:;"  class="default-clr">Favorites ({{ count($rmlsFavs) }})</a>
                           @if(count($rmlsFavs) > 0)
                           <ul class="hover-popup mobile-hide">
                             @foreach($rmlsFavs as $index => $rmlsFavs)
                             @php
                             $hrefUrlA = URL::action('HomeSearch\\HomeSearchController@listing', [$rmlsFavs->County, $rmlsFavs->State, $rmlsFavs->slug, $rmlsFavs->ListingID]);
                             @endphp
                             <li>
                                 <a href="{{ $hrefUrlA }}"> {{ $index+1 }}. {{  $rmlsFavs->FullStreetAddress }}</a>                                            </li>
                             @endforeach
                           </ul>
                           @endif
                         </span>
                     </td>
                     <td>
                         <span  class="{{ count($rmlsSearchs) > 0 ? 'customer-lists' : 'paading-notes' }}">
                           <a href="javascript:;"  class="default-clr">Searches ({{ count($rmlsSearchs) }})</a>
                           @if(count($rmlsSearchs) > 0)
                           <ul class="hover-popup mobile-hide">
                             @foreach($rmlsSearchs as $index => $rmlsSearch)
                             <li>
                               {{ $index+1 }}. <a href="{{ $rmlsSearch->url }}" target="_blank">{{  $rmlsSearch->name }}</a>
                             </li>
                             @endforeach
                           </ul>
                           @endif
                         </span>
                     </td>
                     <td>
                         <span  class="{{ count($rmlsTours) > 0 ? 'customer-lists' : 'paading-notes' }}">
                           <a href="javascript:;"  class="default-clr">Tours ({{ count($rmlsTours) }})</a>
                           @if(count($rmlsTours) > 0)
                           <ul class="hover-popup mobile-hide">
                             @foreach($rmlsTours as $index => $log)
                             @php
                             $hrefT = "";
                             if($log->eloquent == 'rmls_property' && $log->eloquent_id != '' && !in_array($log->log_type, ['search', 'listing_visit'])) {
                                 $rmls = $log->rmls($log->eloquent_id);
                                 if($rmls) {
                                     $hrefT = URL::action('HomeSearch\\HomeSearchController@listing', [$rmls->County, $rmls->State, $rmls->slug, $rmls->ListingID]);
                                 }
                             }
                             if($log->log_type == 'saved_search') {
                                 $meta = (array) json_decode($log->meta);
                                 if(@$meta['url']) {
                                     $hrefT = $meta['url'];
                                 }
                             }
                             if($hrefT == "") {
                                 $sX = explode(",", explode("#", $log->log)[1]);
                                 if(count($sX) == 1) {
                                   $rmls = $log->rmls(@$sX[0]);
                                   if($rmls) {
                                     $hrefT = URL::action('HomeSearch\\HomeSearchController@listing', [$rmls->County, $rmls->State, $rmls->slug, $rmls->ListingID]);
                                   }
                                }
                             }
                             @endphp
                             <li>

                                @if($hrefT != "")
                                <a href="{{ $hrefT }}" target="_blank">{{ $index+1 }}. {{  @explode(":",$log->log)[1] }}                                               @else
                                 <a>{{ $index+1 }}. {{  @explode(":",$log->log)[1] }}</a>
                                @endif
                               
                             </li>
                             @endforeach
                           </ul>
                           @endif
                         </span>
                     </td> 
                     <td>
                         <button class="advanced-search-a {{ $reasignTCount == 0 ? 'disabled' : '' }}" 
                         onclick="showuserbstickets('{{ $ticket->id }}', '{{ $tcustomer->id }}')">Redesignate</button>
                     </td>
                 </tr>
             </table> --}}
              <tr>                         
<div class="" id="home_search_details_form">

<form method="POST" action="{{URL::action('Admin\TicketsController@saveHiringReports')}}" id="hiring_reports"  class="home-search-form" autocomplete="off">
  {{ csrf_field() }} 
<div class="row">
<input type="hidden" name="creator_id" value="{{Auth::user()->id}}">
<input type="hidden" name="ticket_id" value="{{$ticket->id}}">

<div class="col-sm-12">
    <label for="status_update" class="transaction-labels">Status Update</label>
   <textarea class="form-control val" name="status_update">{{(@$hiring_reports->status_update) ? $hiring_reports->status_update : ''}}</textarea>
   </div>
   
   
   <div class="summary-btns">
   <button type="submit" class="mr-2 form-control transition-button save-button"  name="submit">Save</button>
   <!-- <button type="reset" class="form-control transition-button"  name="cancel" onclick="resetForm('home_search_details')">Reset</button> -->
   <button type="button" class="form-control transition-button cancel-button"  name="cancel" onclick="resetForm('hiring_reports')">Cancel</button>
   </div>
   
               </form>
   
                   </div>
                   </tr>
            @if($ticketUser)
             <div class="cus-table-header lightblue has-white-col m-0">
               <h2 class='d-flex align-items-center'>Candidate Fields</h2>
             </div>
             <form method="POST" action="{{URL::action('Admin\TicketsController@saveCandidateDetails', $ticketUser->id)}}" id="candidate_fields" class ="mt-2 candidate_fields_form" autocomplete="off">
             {{ csrf_field() }}
             <div class="row">
                <input type="hidden" name="id" id="id" value="{{ ($ticketUser) ? $ticketUser->id : 0 }}">
                <input type="hidden" name="ticket_id" value="{{$ticket->id}}">
                <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group {{ $errors->has('source') ? ' has-error' : '' }} ">
                        <label for="source" class="col_label">Source</label>
                        <select name="userprofile[source]" id="source" class="select-two-dd">
                                    <option value="">Select</option>
                                    @foreach(config('toptech.sources_for_job') as $key => $source)
                                        <option value="{{ $key }}" {{ ($ticketUser->source ==  $source || old('source') ==  $source  ) ? 'selected' : '' }}   >{{ $source }}</option>
                                    @endforeach
                        </select>
                    </div>
                </div>
   
                <div class="col-sm-12 col-md-4">
                    <div class="form-group wrap {{ $errors->has('additional_info_for_source') ? ' has-error' : '' }}  ">
                        <label for="additional_info_for_source">Additional info for source</label>
                        <input type="text" class="form-control" id="additional_info_for_source"  placeholder="Additional info for source"  name="userprofile[additional_info_for_source]" value="{{ old('additional_info_for_source') ? old('additional_info_for_source') :  $ticketUser->additional_info_for_source }}">
                    </div>
                </div>
   
   
                <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group {{ $errors->has('status') ? ' has-error' : '' }} ">
                        <label for="status" class="col_label">Status</label>
                        <select name="userprofile[status]" id="status" class="select-two-dd" onchange="toggleSnooze(this.value)">
                                    <option value="">Select</option>
                                   @foreach(config('toptech.status_for_candidate') as $key => $status)
                                        <option value="{{ $key }}" {{ ($ticketUser->status ==  $key || old('status') ==  $status  ) ? 'selected' : '' }}   >{{ $status }}</option>
                                    @endforeach
                                    
                        </select>
                        {{-- @php
                            $snooze_date = old('snooze_date') ? old('snooze_date') : $user->snooze_date;
                            $snoozeClass = 'display-none';
                            if($user->status == 'snooze') {
                                $snoozeClass = "";
                            }
                        @endphp
                        @include('admin.customers._includes.snooze_date') --}}
                    </div>
                </div>
   
                <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group {{ $errors->has('priority') ? ' has-error' : '' }} ">
                        <label for="priority" class="col_label">Priority</label>
                        <select name="userprofile[priority]" id="priority" class="select-two-dd">
                           <option value="">Select Priority</option>
                           <option value="high" {{ ($ticketUser->priority ==  'high' || old('priority') ==  'high'  ) ? 'selected' : '' }}>High</option>
                           <option value="medium" {{ ($ticketUser->priority ==  'medium' || old('priority') ==  'medium'  ) ? 'selected' : '' }}>Medium</option>
                           <option value="low" {{ ($ticketUser->priority ==  'low' || old('priority') ==  'low'  ) ? 'selected' : '' }}>Low</option>
                        </select>
               
                    </div>
                </div>
   
                {{-- <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group {{ $errors->has('first_contact_method') ? ' has-error' : '' }} ">
                        <label for="first_contact_method" class="col_label">First contact method</label>
                        <select name="userprofile[first_contact_method]" id="first_contact_method" class="select-two-dd">
                                    <option value="">Select</option>
                                    @foreach(config('toptech.first_contact_methods') as $key => $first_contact_method)
                                        <option value="{{ $key }}" {{ ($ticketUser->first_contact_method ==  $key || old('first_contact_method') ==  $key  ) ? 'selected' : '' }}  >{{ $first_contact_method }}</option>
                                    @endforeach
                        </select>
                
                    </div>
                </div> --}}
   
   
                {{-- <div class="col-sm-12 col-md-4">
                    <div class="form-group {{ $errors->has('phone_number_verify_status') ? ' has-error' : '' }} ">
                    
                    <label for="phone_number_verify_status">Phone Number Verify Status</label>
                    <select name="userprofile[phone_number_verify_status]" id="phone_number_verify_status" class="select-two-dd">
                                <option value="0" {{ ($ticketUser->phone_number_verify_status ==  0 || old('phone_number_verify_status') ==  0) ? 'selected' : '' }}>No</option>
                                <option value="1" {{ ($ticketUser->phone_number_verify_status ==  1 || old('phone_number_verify_status') ==  1 ) ? 'selected' : '' }} >Yes</option>
                    </select>
                    @if($user->phone_number_verify_status == 1)
                    <p>Phone number verified by <b>{{ $ticketUser->phoneVerifiedBy ? $ticketUser->phoneVerifiedBy->name : '-' }}</b></p>
                    @endif
                    </div>
                </div> --}}
   
                 {{-- <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group {{ $errors->has('timeframe') ? ' has-error' : '' }} ">
                        <label for="timeframe" class="col_label">Timeframe</label>
                       <select name="userprofile[timeframe]" id="timeframe" class="select-two-dd">
                            <option value="">Select</option>
                            @foreach(config('toptech.timeframe') as $key => $timeframe)
                                <option value="{{ $timeframe }}" {{ ( $ticketUser->timeframe ==  $timeframe || old('timeframe') ==  $timeframe  ) ? 'selected' : '' }}  >{{ $timeframe }} </option>
                            @endforeach
                            </select>
                    </div>
                </div>   --}}
                
                <div class="col-sm-12 col-md-4 agent__col-input">
                    <div class="form-group">
                        <label for="staff_id" class="col_label">Staff</label>
                        <select class="send-pma-users select-two-dd col_input" name="userprofile[staff_id]" id="staff_id"  >
                         <option value="0" id="" >Select</option>
                         @foreach($agents as  $key => $agent)
                            <option value="{{ $agent->id }}" id="{{ $agent->id }}" {{ ($ticketUser->staff_id ==  $agent->id || old('staff_id') ==  $agent->id ) ? 'selected' : '' }} >{{ $agent->name }}</option>
                         @endforeach
                    </select>
                    </div>
                </div>
   
                <div class="col-sm-12 col-md-4">
                    <div class="form-group wrap">
                        <label for="created_date">Tags</label>
                        <input type="text" class="form-control " id="tags"  placeholder="Tags"  name="userprofile[tags]" value="{{ old('tags') ? old('tags') :  $ticketUser->tags }}">
                    </div>
                </div>
             
                    <div class="summary-btns">
                        <button type="submit" class="mr-2 form-control transition-button save-button" onclick="hideButton('customersaveform');" name="submit">Save</button>
                        <button type="button" class="form-control transition-button cancel-button" onclick="resetForm('candidate_fields')">Cancel</button>
               
                    </div>
            </div>
            </form>
            @endif
            </div>
   
            </div>
   
            
        </div>

     
 
 <?php }
 }
 ?>
 <!-- Hiring -->
                </div>
                </div>

               
  <!-- Transaction details -->
<?php 
if($ticketassignTo) {
if($ticketassignTo->id == 33 || $ticketassignTo->id == 41 || $ticketassignTo->id == 40 || $ticketassignTo->id == 50            /*||$ticketassignTo->id ==  14*/) {
?>

                <div class="form-container content-container chat-panel" id="transaction_details_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_transaction_details">
                            <div class="cus-table-header cursor-pointer" id="ec_transaction_detailscontainer_header" onclick="CEToggle('ec_transaction_detailscontainer'); viewTransactionDetails();" >
                                <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-white.svg') }}">
                                        <h2>Transaction Summary</h2>
                                        </div>
                                
                            </div>
                          <div class="display-none" id="ec_transaction_detailscontainer" >
                            <div id="transaction_details_dynamic_content">
                                
                            </div>
                         </div>
                        </div>
                    </div>
                </div>
<?php } } ?>
<?php if($ticketassignTo) {  if($ticketassignTo->id == 28) {
?>
                <div class="form-container content-container chat-panel" id="work_order_details_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_work_order_details">
                            <div class="cus-table-header cursor-pointer" id="ec_work_order_detailscontainer_header" onclick="CEToggle('ec_work_order_detailscontainer'); editWorkOrderDetails();" >
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_white.svg') }}">
                                <h2>Work Order Summary</h2>
                                </div>
                            </div>
                          <div class="display-none" id="ec_work_order_detailscontainer" >
                            <div id="work_order_details_dynamic_content">
                                
                            </div>
                         </div>
                        </div>
                    </div>
                </div>
<?php } } ?>

<?php if($ticketassignTo) {  if($ticketassignTo->id == 34) {
?>
                <div class="form-container content-container chat-panel" id="rental_listing_detail_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_rental_listing_detail">
                            <div class="cus-table-header cursor-pointer" id="ec_rental_listing_detailcontainer_header" onclick="CEToggle('ec_rental_listing_detailcontainer'); editRentalListingDetail();" >
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_white.svg') }}">
                                <h2>Rental Listing Summary Card</h2>
                                </div>
                            </div>
                          <div class="display-none" id="ec_rental_listing_detailcontainer">
                            <div id="rental_listing_detail_dynamic_content">
                                
                            </div>
                         </div>
                        </div>
                    </div>
                </div>
<?php } } ?>


<?php if($ticketassignTo) {  if($ticketassignTo->id == 35) {
?>
                <div class="form-container content-container chat-panel" id="leasing_details_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_leasing_details">
                            <div class="cus-table-header cursor-pointer" id="ec_leasing_detailscontainer_header" onclick="CEToggle('ec_leasing_detailscontainer'); editLeasingDetails();" >
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_white.svg') }}">
                                <h2>Leasing Summary</h2>
                                </div>
                            </div>
                          <div class="display-none" id="ec_leasing_detailscontainer" >
                            <div id="leasing_details_dynamic_content">
                                
                            </div>
                         </div>
                        </div>
                    </div>
                </div>
<?php } } ?>
<?php if($ticketassignTo) {  if($ticketassignTo->id == 14) {
?>
                <div class="form-container content-container chat-panel" id="dev_details_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_dev_details">
                            @if($ticket->status != 'closed')
                            <div class="cus-table-header cursor-pointer" id="ec_dev_detailscontainer_header" onclick="CEToggle('ec_dev_detailscontainer'); editDevDetail();" >
                            @else
                            <div class="cus-table-header cursor-pointer" id="ec_dev_detailscontainer_header" onclick="CEToggle('ec_dev_detailscontainer'); viewDevDetail();" >
                            @endif
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/summary_white.svg') }}">
                                <h2>Dev Summary Card</h2>
                                </div>
                            </div>
                          <div class="display-none" id="ec_dev_detailscontainer">
                            <div id="dev_details_dynamic_content">
                                
                            </div>
                         </div>
                        </div>
                    </div>
                </div>
<?php } } ?>


<!-- Transaction details end -->
<!-- hiring jobs card start -->	
@if($ticket->is_job_applicant == 1)	
<div class="orm-container content-container chat-panel"> 	
    <div class="row">	
        <div class="col-12 col-md-12" id="scroll_to_jobs">	
            <div class="cus-table-header cursor-pointer jobs-arrow" id="jobs_toggle_panel_header"  onclick="CEToggle('jobs_toggle_panel'); tabOptions('tab/filters/jobs', 't_f_customer_jobs', 'candidate', 'jobs');" >	
                <input type="hidden" name="t_f_customer_jobs_h" id="t_f_customer_jobs_h" value="0">	
                <input type="hidden" class="hiddenappendvalues" name="candidate_id" value="{{ $ticket->candidate_id }}">	
                <div class="icon-title">	
                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/job-black.svg') }}">	
                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/job-white.svg') }}">	
                    <h2>Jobs ({{ $candidateApplicationsCount }}) </h2>	
                </div>	
            </div>	
            <div class="table-responsive-jobs display-none jobs_toggle" id="jobs_toggle_panel">	
                <div class="t_f_customer_jobs" id="t_f_customer_jobs"></div>	
            </div>	
        </div>	
    </div>	
</div>	
@endif	
<!-- hiring jobs card end -->
<!-- orc card -->
<?php 
if($ticketassignTo) {
if($ticketassignTo->id == 78 || $ticketassignTo->id == 79 || $ticketassignTo->id == 80 ) {
?>
    <div class="form-container content-container chat-panel" id="orc_details_whole_block">
        <div class="row admsn-form">
            <div class="col-12 col-md-12" id="scroll_to_orc_details">
                <div class="cus-table-header cursor-pointer" id="ec_orc_detailscontainer_header" onclick="CEToggle('ec_orc_detailscontainer'); vieworcDetails();" >
                    <div class="icon-title">
                        <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-black.svg') }}">
                        <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-white.svg') }}">
                        <h2>Admission Summary</h2>
                    </div>             
                </div>

                <div class="display-none" id="ec_orc_detailscontainer" >
                    <div class="col-12 col-md-12 my-3">
                        <div class="cus-table-header cursor-pointer viewpage-accordian-header" id="admisstionsummaryFields_header" onclick="CEToggleinside('admisstionsummaryFields','form-control-static_admisstionsummaryfields')" >                            
                        <div class="icon-title">
                            <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-black.svg') }}">
                            <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/transaction-summary-white.svg') }}">
                            <h2>Admission Summary Fields</h2>
                        </div>   
                        @if($ticket->status != 'closed') 
                        <div id="form-control-static_admisstionsummaryfields" class="cus-hdr-rht form-control-static_admisstionsummaryfields"> 
                            <a href="javascript:;" onclick="ocasummaryfileds()" id="admisstionsummaryfields-card"  class='custom-a'>
                                <button type="button" class="next-step button_edit_right" >
                                    <span>Edit</span>
                                    <i class="fa fa-pencil custom-icon"></i>
                                </button>
                            </a>
                        </div>
                        @endif
                    </div>
                    <div class="hidetoggle" id="admisstionsummaryFields">
                        <form method="POST" action="{{URL::action('Admin\TicketsController@saveOrcReports')}}" id="orc_reports"  class="home-search-form" autocomplete="off">
                            {{ csrf_field() }} 
                            <div class="row">
                                <input type="hidden" name="creator_id" value="{{Auth::user()->id}}">
                                <input type="hidden" name="ticket_id" value="{{$ticket->id}}">
                                <div class="col-sm-12">
                                    <label for="status_update" class="transaction-labels">Ticket status update</label>
                                    <textarea class="form-control val" name="status_update" disabled>{{(@$orc_reports->status_update) ? $orc_reports->status_update : ''}}</textarea>
                                </div>
                                <div class='col-sm-12 col-md-12 summary-btn-wrap  my-3'>
                                    <button type="submit" class="form-control transition-button save-button val mr-2"  name="submit" disabled>Save</button>
                                    <button type="button" class="form-control transition-button cancel-button val"  name="cancel" onclick="resetForm('orc_reports')" disabled>Cancel</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    </div>
                    <div class="col-12 col-md-12 mb-3">
                        @if($ticketUser)    
                            <div class="cus-table-header cursor-pointer viewpage-accordian-header" id="customerFields_header" onclick="CEToggleinsides('customerFields','form-control-static_customerfileds')" >                            
                                <div class="icon-title">
                                    <i class='custom-icon-img black'> <img class="img-wrap black icon-title-icon" width="35" src="{{ url('adminasset/img/sidebaricon/customers-black.svg') }}"></i>
                                    <i class='custom-icon-img white'> <img class="img-wrap white icon-title-icon" width="35" src="{{ url('adminasset/img/sidebaricon/customers-white.svg') }}"></i>
                                    <h2>Customer Profile Fields</h2>
                                </div>   
                                @if($ticket->status != 'closed') 
                                <div id="form-control-static_customerfileds" class="cus-hdr-rht form-control-static_customerfileds"> 
                                    <a href="javascript:;" onclick="ocacustomerfileds()" id="customerfileds-card"  class='custom-a'>
                                        <button type="button" class="next-step button_edit_right" >
                                            <span>Edit</span>
                                            <i class="fa fa-pencil custom-icon"></i>
                                        </button>
                                    </a>
                                </div>
                                @endif
                            </div>
                            <div class="hidetoggle" id="customerFields">
                                <form method="POST" action="{{URL::action('Admin\TicketsController@saveCustomerDetails', $ticketUser->id)}}" id="customer_fields" class ="customer_fields_form form-container" autocomplete="off">
                                    {{ csrf_field() }}
                                    <div class="row">
                                        <input type="hidden" name="creator_id" value="{{Auth::user()->id}}">
                                        <input type="hidden" name="ticket_id" value="{{$ticket->id}}">
                                        <div class="col-sm-12">
                                            <label for="status_update" class="transaction-labels">Customer status update</label>
                                            <textarea class="form-control hiddenfileds" name="userprofile[status_update]" id="C_statusupdate" disabled>{{($ticketUser->status_update) ? $ticketUser->status_update : ''}}</textarea>
                                        </div>
                                        <div class="col-sm-12 col-md-12 my-3 summary-btn-wrap">
                                            <button type="submit" class="form-control transition-button hiddenfileds mr-2" onclick="hideButton('customersaveform');" name="submit" disabled>Save</button>
                                            <button type="button" class="form-control transition-button cancel-button hiddenfileds cancelupdate" onclick="resetForm('customer_fields')" disabled>Cancel</button>
                                        </div>
                                        
                                    </div>
                                </form>
                            </div>
                        @endif
                    </div>
                </div>
            </div>
        </div>
    </div>
                
<?php } } ?>
<!-- end orc card -->

                    <!--Activity Log Start -->
                    <div class="form-container content-container chat-panel" id="activity_log">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_activitylog">
                            <div class="cus-table-header cursor-pointer " 
                            id="ec_activityhistory_panel_header" onclick="CEToggle('ec_activityhistory_panel');tabOptions('tab/filters/activities', 't_f_ticket_activites', 'tickets', 'activity');">
                                <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/activities-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/activities-white.svg') }}">
                                <h2>Activity History ({{ $activitiesCount  }})</h2>
                                </div>
                                <input type="hidden" name="t_f_ticket_activites_h" id="t_f_ticket_activites_h" value="{{ $activitiesCount >= 0 ? 0 : 1 }}">
                                <input type="hidden" class="hiddenappendvalues" name="ticket_id" value="{{ $ticket->id }}">
                                    <div class="cus-hdr-rht">
                                        @if($_GET)
                                            <a href="{{ URL::action('Admin\\TicketsController@show', $ticket->id) }}?tab=activity" class="custom-reset-a">
                                                <i class="i-custom-reset"></i><span class="">Reset Filter</span>
                                            </a>
                                        @endif
                                    </div>
                            </div>
                            <div class="activity_history_form_panel display-none" id="ec_activityhistory_panel" >
                            <div class="t_f_ticket_activites" id="t_f_ticket_activites"></div>
                            </div>
                        </div>
                    </div>
                </div> 
                    <!-- Activity Log End -->
                  
                     <!--Check List Start -->
                <div class="form-container content-container chat-panel" id="checklist_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_checklist">
                            <!-- Triggertask(); -->
                            <div class="cus-table-header cursor-pointer" id="check_textmessage_allmessages_header" 
                            onclick=" CEToggle('check_textmessage_allmessages'); tabOptions('tab/filters/tasks', 't_f_ticket_tasks', 'tickets', 'tasks');">
                                 <!--<h2>Checklists ({{ count($checklists) }}) compChecklists ({{ count($completedChecklists) }})</h2>-->
                                 
                                <input type="hidden" name="t_f_ticket_tasks_h" id="t_f_ticket_tasks_h" value="0">
                               
                                <div class="icon-title">
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/task-black.svg') }}">
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/task-white.svg') }}"> 
                                    <h2>Task list <span id="number_items_to_completed">({{ $incompletedChecklists }}/{{ $checklists }})</span></h2>
                                </div>

                                <div class="title-with-progressbar">
                                <div class='meter-bar'><div class='meter-progress' style="width: {{ $percentage }}%;"></div> </div>
                                </div>

                            </div>
                            <input type="hidden" name="onprocesscheckedlists" id="onprocesscheckedlists" value="{{ $checklists1 }}">
                            <input type="hidden" name="completedcheckedlists" id="completedcheckedlists" value="{{ $completedChecklists1 }}">
                            @foreach($checklist_assigned as $checklistassigned)
                            <input type="hidden" name="checklist_assigned[]" id="checklistassgined" value="{{ $checklistassigned}}">
                            @endforeach
                            <div class="grid_checklist" id="check_textmessage_allmessages" style="display: none;" >
                                <div class="t_f_ticket_tasks" id="t_f_ticket_tasks"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--Check List End -->

                <!--Contact List Starts -->
<?php 
if($ticketassignTo) {
if($ticketassignTo->id == 33 || $ticketassignTo->id == 41 || $ticketassignTo->id == 40 || $ticketassignTo->id == 28 || $ticketassignTo->id == 1 || $ticketassignTo->id == 50 /*||$ticketassignTo->id ==  14*/) {
?>
                <div class="form-container content-container chat-panel" id="contact_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_relatednotes">
                            <div class="cus-table-header cursor-pointer" id="ec_contactscontainer_header" onclick="CEToggle('ec_contactscontainer')" >
                                <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/contact-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/contact-white.svg') }}">
                                <h2>Contact List ({{ count($ticket->contacts) }})</h2>
                                </div>
                            </div>
                            @php
                          $type = 'ticket';
                          $typeId = $ticket->id;
                          @endphp
                          <div class="display-none" id="ec_contactscontainer" >

                           @include('admin.tickets.contacts.create')
                         </div>
                        </div>
                    </div>
                </div>
<?php }
} ?>

<!--Contact List End -->
                    <div class="form-container content-container chat-panel">
                        <div id="CustomScrollBottom"></div>
                    <div class="mail-section cus-table-header mail-section-ma p-0 cursor-pointer header-active" id="all_ticket_email_messages_header" onclick="CEToggle('all_ticket_email_messages');$('.email-hide').hide();$('#mail-bubble').show();" >
                        <div class="col-12 col-md-6">
                            <div class="twilio-message-reply-container">
                                <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/mail-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/mail-white.svg') }}">
                                <h2>EMAIL MESSAGES  ({{ $ticketHistoriesCount  }})</h2>
                                </div>
                            </div>
                        </div>
                        <div id="reply-ticket-form" style="width: 100%; float: left;"></div>
                        <div class="col-12 col-md-6 right-content">
                            <div class="expand-collapse-panel">
                            </div>
                        </div>
                    </div>
                    <div class="form-container ticket-histories creattickets-form-container" id="all_ticket_email_messages">
                        @if($ticketHistoriesCount > 4)
                        @foreach($ticketHistories as $ticketHistory)
                        {{-- @if(!$loop->first) --}}
                        @php
                            $notified = $ticketHistory->notifiedMessageRaw($ticketHistory->activity, $ticketHistory->activity_id);
                            $nameByEmails = $ticketcreator->getNameByEmail(strtolower($ticketHistory->sent_by_email));
                        @endphp

                        <div class="col-12 col-lg-12 ticket-panel ticket-panel-container  {{  $ticketHistory->ticket_type }} {{ $loop->last ? 'full-height' : '' }} {{!$loop->first && !$loop->last ? 'email-hide display-none' : ''}}" id="ticket_history_{{ $ticketHistory->id }}">
                            <div class="accordian-panel ticket-panel" onclick="toggleAccordian({{ $ticketHistory->id }})">    
                                <div class="row">
                                    <div class="{{  $ticketHistory->ticket_type }} col-sm-6 col-lg-7 left">
                                        <p class="message-body text-truncate ">
                                            {!! substr(strip_tags($ticketHistory->body), 0, 201) !!}
                                        </p>
                                    </div>
                                    <div class="{{  $ticketHistory->ticket_type }} col-sm-6  col-lg-5 right">
                                        <p class="message-author"  title="{{ $ticketHistory->sent_by_email }}"><span> 
                                         @if(count($ticketHistory->emailAttachments) > 0)
                                  
                                        <img class="attachIcon" width="20" src="{{ url('adminasset/img/paperclip-black.svg') }}">
                                        @endif
                                        {{ (@$nameByEmails[strtolower($ticketHistory->sent_by_email)]) ? $nameByEmails[strtolower($ticketHistory->sent_by_email)] : $ticketHistory->sent_by_email }} - {{ \App\Helpers\CustomHelper::dateFormatUS("$ticketHistory->created_at") }}</span></p>
                                        <input class="star star-position-email {{ in_array($ticketHistory->id, $bookmark_email_ids) ? 'starchecked':'' }}  bookmark-star"  type="checkbox" title="Bookmark this email" onclick="bookmarkThisActivity({{ $ticketHistory->id }}, 'email');bookmarkThisActivityPage({{ $ticketHistory->id }}, 'email',{{$ticketHistory->activityids}}, 'activity');" value="{{ $ticketHistory->id }}" id="bmemail{{ $ticketHistory->id }}" {{ in_array($ticketHistory->id, $bookmark_email_ids) ? '':'checked' }} >
                                        <i class="fa fa-{{ $loop->last ? 'minus' : 'plus' }}"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="{{  $ticketHistory->ticket_type }} accordian-content">
                                <div class="cc-container">
                                    @if($notified)
                                    @php
                                        $passNotifyId = 'mail'.$notified['notifiedId'];
                                    @endphp
                                    <i class="notified-users-p cursor-pointer text-left" onclick="toggleNotifiedUsers('{{ $passNotifyId }}')">
                                        (<span class="notified-msg" ></span>{{ $notified['notifiedMessage'] }}<span class="notified-hover-users" id="notified_hover_users_{{ $passNotifyId }}"> -&nbsp;{{ $notified['notifiedUsers'] }}</span>)
                                    </i>
                                    @else
                                    <i class="notified-users-p cursor-pointer text-left" style="color:red;">Undelivered</i>
                                    @endif
                                    <i>CC: {{ ($ticketHistory->cc) ? $ticketHistory->cc : '-' }}</i>
                                </div>
                                <div class="ticket-container openblank">

                                    <p>{!! nl2br($ticketHistory->body) !!}</p>
                                    @if($ticketHistory->emailAttachments )
                                    @foreach($ticketHistory->emailAttachments as $attachment)
                                    @php
                                        $attachmentUrl = "";
                                        $image = $attachment->attachment;
                                        if (file_exists( public_path($image) ) ) {
                                            $attachmentUrl = url($image);
                                        } else {
                                            $attachmentUrl = url('/')."/storage".$image;
                                        }
                                    @endphp
                                        @if($attachmentUrl)
                                            <p class="message-body attachment-ticket">
                                                <a href="{{ route('downloademail', $attachment->id)  }}" target="_blank">
                                                                        <i><img src="{{ url('adminasset/img/document-with-paperclip.svg') }}" style=" width: 22px;"></i>    {{ last(explode("/",$attachment->attachment)) }}
                                                </a>
                                                @if($ticket->is_job_applicant != 1)
                                                (<a href="{{ URL::action('Admin\\DocumentController@create', ['ticket_id='.$ticket->id, 'attachment_id='.$attachment->id, 'with_image=1']) }}">Move to documents</a>)
                                                @endif
                                            </p>
                                        @endif
                                    @endforeach
                                    @endif

                                </div>
                            </div>
                        </div>
                        @if($loop->first)
                        <div class="count-panel" id="mail-bubble" onclick="email_show()">
                            <span class="upper-line"></span>
                                 <span class="mail-bubble" > {{ $ticketHistoriesCount - 2 }} </span>
                            <span class="lower-line"></span>
                        </div>
                        @endif
                        {{-- @endif --}}
                        @endforeach
                        @elseif($ticketHistoriesCount > 0)
                        @foreach($ticketHistories as $ticketHistory)
                        {{-- @if(!$loop->first) --}}
                        @php
                            $notified = $ticketHistory->notifiedMessageRaw($ticketHistory->activity, $ticketHistory->activity_id);
                            $nameByEmails = $ticketcreator->getNameByEmail(strtolower($ticketHistory->sent_by_email));
                        @endphp

                        <div class="col-12 col-lg-12 ticket-panel ticket-panel-container  {{  $ticketHistory->ticket_type }} {{ $loop->last ? 'full-height' : '' }} " id="ticket_history_{{ $ticketHistory->id }}">
                            <div class="accordian-panel ticket-panel" onclick="toggleAccordian({{ $ticketHistory->id }})">
                                <div class="row">
                                    <div class="{{  $ticketHistory->ticket_type }} col-sm-6 col-lg-7 left">
                                        <p class="message-body text-truncate ">
                                            {!! substr(strip_tags($ticketHistory->body), 0, 201) !!}
                                        </p>
                                    </div>
                                    <div class="{{  $ticketHistory->ticket_type }} col-sm-6  col-lg-5 right">
                                        <p class="message-author"  title="{{ $ticketHistory->sent_by_email }}"><span> 
                                         @if(count($ticketHistory->emailAttachments) > 0)
                                  
                                        <img class="attachIcon" width="20" src="{{ url('adminasset/img/paperclip-black.svg') }}">
                                        @endif

                                        {{ (@$nameByEmails[strtolower($ticketHistory->sent_by_email)]) ? $nameByEmails[strtolower($ticketHistory->sent_by_email)] : $ticketHistory->sent_by_email }} - {{ \App\Helpers\CustomHelper::dateFormatUS("$ticketHistory->created_at") }}</span></p>
                                        <input class="star star-position-email {{ in_array($ticketHistory->id, $bookmark_email_ids) ? 'starchecked':'' }}  bookmark-star"  type="checkbox" title="Bookmark this email" onclick="bookmarkThisActivity({{ $ticketHistory->id }}, 'email');bookmarkThisActivityPage({{ $ticketHistory->id }}, 'email',{{$ticketHistory->activityids}}, 'activity');" value="{{ $ticketHistory->id }}" id="bmemail{{ $ticketHistory->id }}" {{ in_array($ticketHistory->id, $bookmark_email_ids) ? '':'checked' }} >

                                        <i class="fa fa-{{ $loop->last ? 'minus' : 'plus' }}"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="{{  $ticketHistory->ticket_type }} accordian-content">
                                <div class="cc-container">
                                    @if($notified)
                                    @php
                                        $passNotifyId = 'mail'.$notified['notifiedId'];
                                    @endphp
                                    <i class="notified-users-p cursor-pointer text-left" onclick="toggleNotifiedUsers('{{ $passNotifyId }}')">
                                        (<span class="notified-msg" ></span>{{ $notified['notifiedMessage'] }}<span class="notified-hover-users" id="notified_hover_users_{{ $passNotifyId }}"> -&nbsp;{{ $notified['notifiedUsers'] }}</span>)
                                    </i>
                                    @else
                                    <i class="notified-users-p cursor-pointer text-left" style="color:red;">Undelivered</i>
                                    @endif
                                    <i>CC: {{ ($ticketHistory->cc) ? $ticketHistory->cc : '-' }}</i>
                                </div>
                                <div class="ticket-container openblank">
                                    
                                    <p>{!! nl2br($ticketHistory->body) !!}</p>
                                    @if($ticketHistory->emailAttachments )
                                    @foreach($ticketHistory->emailAttachments as $attachment)
                                    @php
                                        $attachmentUrl = "";
                                        $image = $attachment->attachment;
                                        if (file_exists( public_path($image) ) ) {
                                            $attachmentUrl = url($image);
                                        } else {
                                            $attachmentUrl = url('/')."/storage".$image;
                                        }
                                    @endphp
                                        @if($attachmentUrl)
                                            <p class="message-body attachment-ticket">
                                                <a href="{{ route('downloademail', $attachment->id)  }}" target="_blank">
                                                                        <i><img src="{{ url('adminasset/img/document-with-paperclip.svg') }}" style=" width: 22px;"></i>    {{ last(explode("/",$attachment->attachment)) }}
                                                </a>
                                                @if($ticket->is_job_applicant != 1)
                                                (<a href="{{ URL::action('Admin\\DocumentController@create', ['ticket_id='.$ticket->id, 'attachment_id='.$attachment->id, 'with_image=1']) }}">Move to documents</a>)
                                                @endif
                                            </p>
                                        @endif
                                    @endforeach
                                    @endif

                                </div>
                            </div>
                        </div>
                        {{-- @endif --}}
                        @endforeach
                        @endif
                        <div class="form-container creattickets-form-container creattickets-form-container-ma {{ (@$menuPrivilagesAll['tickets']  == 'write' ) ? '' : 'display-none' }}" id="replyticketcontainer">
                            <div class="reply-container">
                                <form class="cd-form tickets-view-form" method="POST" action="{{ URL::action('Admin\\TicketsController@replyTicket', [$ticket->id]) }}" id="profile_update_reply_ticket" enctype='multipart/form-data'>
                                    {{ csrf_field() }}
                                    <div class="row">
                                        <div class="col-12">  
                                            <h5 class="{{ $ticket->status != 'closed'  ? 'reply-ticket-title' : '' }}" style="display: flex;"  title="{{ $ticket->status == 'closed'  ? 'No reply allowed because the ticket is closed': '' }}"><a href="javascript:;" class="btn-blue reply-button" onclick="editorById('body',draft_change('Reply'))" style="{{ $ticket->status == 'closed'  ? 'background: #7992c5b3' : '' }}">Reply</a> 
                                            @if($ticket->status == 'closed')
                                                <p style="text-color: ##a0b1d6; margin:15px;" >No reply allowed because the ticket is closed</p>   
                                                @endif
                                                </h5> 
                                            @if($ticketTemplates->count() > 0)
                                            <div class="reply-text-description reply-text-description-ticket" style="display: none">
                                                <div class="row">
                                                    <!-- <div class="">-->
                                                    <h1 id="mob-ticket-reply-click">Ticket Summary Fields (<span id="mob-ticket-reply-click-span">+</span>)</h1>
                                                    <div class="ticket_panel_desc row no-padding">  
                                                        <div class="col-sm-3 panel row xlpanel">
                                                            <label class="m-0 col-4 col-lg-2 col-form-label align-label-ticketview" for="priority">Template</label>
                                                            <select class="col-8 col-lg-10 send-pma-users select-two-dd form-control" name="select_template" id="select_template" onchange="loadTemplate(this.value, 'exampleFormControlTextarea1', 'tinymce', 'tickets-view-form')">
                                                                <option value="">Select</option>
                                                                @foreach($emailTemplates as $emailTemplate)
                                                                <option value="{{ $emailTemplate->id }}">{{ $emailTemplate->id }} - {{ $emailTemplate->title }}</option>
                                                                @endforeach
                                                            </select>
                                                        </div>
                                                    <!-- </div> -->
                                                    @endif
                                                    <input type="hidden" id="ticket_hide_type" name="ticket_hide_type" value= "{{$ticket->ticket_type}}">
                                                    <div class="col-sm-3 mb-2 panel row xlpanel" id="company_validation">
                                                        <label class="m-0 col-4 col-lg-2 col-form-label align-label-ticketview"  for="property_id_bottom">Child</label>
                                                        <select class="send-pma-users property-next-span  select-two-dd col-8 col-lg-10" name="property_id" id="property_id_bottom">
                                                            <option value="">Select</option>
                                                            @if($propeties)
                                                            @foreach($propeties as $propety)
                                                            <option value="{{ $propety->id }}" id="property_{{ $propety->id }}" {{ $propety->id == $ticket->child_id  ? 'selected' : '' }} data-name="{{ ($propety->child_name.' '.$propety->child_lastname) }}"> {{($propety->child_name.' '.$propety->child_lastname)}}</option>
                                                            @endforeach
                                                            @endif
                                                        </select>
                                                    </div>
                                                   
                                                    <!-- <div class="col-sm-6">
                                            <label for="madrill_mail_bcc">Bcc</label>
                                          <input type="text" name="madrill_mail_bcc" class="form-control" id="madrill_mail_bcc" class="madrill_mail_bcc" placeholder="BCC" >
                                          <br>
                                        </div> -->  
                                                    <div class="col-sm-3 mb-2 panel row xlpanel" id="group_validation">
                                                        <label class="m-0 col-4 col-lg-2 col-form-label align-label-ticketview" for="assigned_to_bottom">Group</label>
                                                        <select class="col-8 col-lg-10 send-pma-users select-two-dd" name="assigned_to" id="assigned_to_bottom" onchange="getUserBottom(this.value)">
                                                            <option value="0">Select</option>
                                                            @if($customers->count() > 0)
                                                            @foreach($groups as $group)
                                                            <option value="{{ $group->id }}" id="group{{ $group->id }}" {{ $ticket->assigned_to == $group->id  ? 'selected' : '' }} data-name="{{ $group->name }}">{{ $group->name }}</option>
                                                            @endforeach
                                                            @endif
                                                        </select>
                                                    </div>

                                                    
                                                    <div class="col-sm-3 mb-2 panel row xlpanel xlpanel-st-pr" id="staff_validation">
                                                        <label class="m-0 col-4 col-lg-2 col-form-label align-label-ticketview" for="assigned_to_staff_bottom">Staff</label>
                                                        <select class="col-8 col-lg-10 send-pma-users select-two-dd" name="assigned_to_staff" id="assigned_to_staff_bottom">
                                                            <option value="0">Select</option>
                                                            @if($users->count() > 0)
                                                            @foreach($users as $user)
                                                            <option value="{{ $user->id }}" id="user{{ $user->id }}" {{ $ticket->assigned_to_staff  == $user->id  ? 'selected' : '' }} data-name="{{ $user->name }}">{{ $user->name }}</option>
                                                            @endforeach
                                                            @endif
                                                        </select>
                                                    </div>
                                                    <div class="col-sm-3 panel mb-2 row priority-width-status xlpanel">
                                                        <div class="col-12 row priority-row">

                                                        <label class="m-0 col-4 col-lg-2 col-form-label priority-align-label align-label-ticketview" for="priority_bottom">Priority</label>
                                                        <select class="send-pma-users select-two-dd col-8 col-lg-10 priority-select-next" name="priority" id="priority_bottom">
                                                            <option value="low" id="low" {{ $ticket->priority == 'low'  ? 'selected' : '' }} data-name="Low">Low</option>
                                                            <option value="medium" id="medium" {{ $ticket->priority == 'medium'  ? 'selected' : '' }} data-name="Medium">Medium</option>
                                                            <option value="high" id="high" {{ $ticket->priority == 'high'  ? 'selected' : '' }} data-name="High">High</option>
                                                            <option value="showstopper" id="showstopper" {{ $ticket->priority == 'showstopper'  ? 'selected' : '' }} data-name="Showstopper">Showstopper</option>
                                                        </select>
                                                        </div>
                                                        
                                                    </div>
                                                    <div class="col-sm-3 panel mb-2 row priority-width-status xlpanel">
                                                       
                                                        <div class="col-12 row status-row">
                                                            <label class="m-0 col-4 col-lg-2 col-form-label status-align-label align-label-ticketview" for="status_bottom">Status</label>
                                                        <select class="col-8 col-lg-10  send-pma-users select-two-dd priority-select-next" name="status" id="status_bottom">
                                                            <option value="open" id="open" {{ $ticket->status == 'open'  ? 'selected' : '' }} data-name="Open">Open</option>
                                                            <option value="in_process" id="in_process" {{ $ticket->status == 'in_process'  ? 'selected' : '' }} data-name="In-Process">In-Process</option>
                                                            @if(($ticket->assigned_to) == 14 )  
                                                            <option value="Completed (Staging)" id="Completed (Staging)" {{ $ticket->status == 'Completed (Staging)'  ? 'selected' : '' }} data-name="Completed (Staging)">Completed (Staging)</option>
                                                            <option value="Validated (Staging)" id="Validated (Staging)" {{ $ticket->status == 'Validated (Staging)'  ? 'selected' : '' }} data-name="Validated (Staging)">Validated (Staging)</option>
                                                            @endif
                                                            <option value="completed" id="completed" {{ $ticket->status == 'completed'  ? 'selected' : '' }} data-name="Completed">Completed</option>
                                                            <option value="closed" id="closed" {{ $ticket->status == 'closed'  ? 'selected' : '' }} data-name="Closed">Closed</option>
                                                            
                                                        </select>
                                                        </div>
                                                        
                                                    </div>

                                                    @if($ticket->ticket_type != 'customer' && $ticket->is_job_applicant != 1)
                                                        @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_ticketSummary_class") == 1)
                                                            <div class="col-sm-3 mb-2 panel row priority-width-status xlpanel">
                                                                <div class="col-12 row status-row">
                                                                    <label class="m-0 col-4 col-lg-2 col-form-label status-align-label align-label-ticketview" for="class">Class</label>
                                                                    <select class="col-8 col-lg-10  send-pma-users select-two-dd priority-select-next" name="class" id="class_version">
                                                                            <option value="">Select</option>
                                                                        <option value="bug" id="bug" {{ $ticket->class == 'bug'  ? 'selected' : '' }} data-name="Bug">Bug</option>
                                                                            <option value="enhancement" id="enhancement" {{ $ticket->class == 'enhancement'  ? 'selected' : '' }} data-name="Enhancement">Enhancement</option>
                                                                            <option value="feature" id="feature" {{ $ticket->class == 'feature'  ? 'selected' : '' }} data-name="Feature">Feature</option>
                                                                            <option value="question" id="question" {{ $ticket->class == 'question'  ? 'selected' : '' }} data-name="Question">Question</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        @endif
                                                        @if (\App\Helpers\CustomHelper::getgeneral("website_has","privileges_ticketSummary_version") == 1)
                                                            <div class="col-sm-3 panel mb-2 row priority-width-status xlpanel">
                                                                <div class="col-12 row status-row">
                                                                    <label class="m-0 col-4 col-lg-2 col-form-label status-align-label align-label-ticketview" for="version">Version</label>
                                                                    <input type="text" name="version" id="version_bottom" class="form-control" style="flex: 0 0 76.5%;" value="{{ $ticket->version }}">
                                                                </div>
                                                            </div>
                                                        @endif
                                                   @endif

                                                    <div class="col-sm-3 mb-2 panel row xlpanel xlpanel-cc">
                                                            <label class="m-0 col-4 col-lg-2 col-form-label accessible-align-label align-label-ticketview" for="accessible_users_reply">Access</label>
                                                                <select class="send-pma-users select-two-dd" name="accessible_users[]" id="accessible_users_reply" multiple="multiple" >
                                                                    @if( count($accessibleUsers) > 0)
                                                                        @foreach($accessibleUsers as $accessibleUser)
                                                                             <option value="{{ $accessibleUser->id }}" {{ in_array($accessibleUser->id, $accessibleUserIds) ? 'selected' : '' }}  >{{ $accessibleUser->nameWithRole }}</option>
                                                                        @endforeach                                    
                                                                    @endif
                                                                </select>
                                                    </div>
                                                    @if(Auth::user()->isAdmin || ( \App\Helpers\CustomHelper::ticketeditaccess(Auth::user()->id) > 0 ) )
                                                        <div class="form-group col-sm-12" style="min-height: 43px;">
                                                            <label for="hide_ticketid_bottom"> 
                                                                <input type="checkbox" name="hide_ticketid" id="hide_ticketid_bottom" value="{{ $ticket->hide_ticketid}}" {{ $ticket->hide_ticketid == 1 ? 'checked' : '' }}> 
                                                                Hide ticket ID in notification email subject
                                                            </label>
                                                        </div> 
                                                    @else
                                                        <input type="hidden" name="hide_ticketid" id="hide_ticketid_bottom" value="{{ $ticket->hide_ticketid}}"> 
                                                    @endif
                                                   
                                                </div>
                                                  
                                                <div class="col-sm-12 ticket-attachment margin-bottom-8 float-left" style="min-height: 62px;">
                                                    <label for="property_id_bottom">To: <strong>{{ $passNames }}</strong></label> <br/>
                                                    <label for="property_id_bottom">CC: </label>
                                                    <input type="text" style="display: inline-block;" name="madrill_mail_cc" class="form-control col-8 col-lg-10" id="madrill_mail_cc" class="madrill_mail_cc" placeholder="CC" value="{{ ($ticketLast) ? $ticketLast->cc : '' }}">
                                                </div>
                                                
                                                    <div class="col-12 panel col-lg-12  " id="replyticket_tinymce_editor">
                                                        <div class="reply-container reply-panel" style="padding: 0;">
                                                            <div class="form-group {{ $errors->has('body') ? ' has-error' : '' }} ">
                                                                <!-- <input type="hidden" name="assigned_to_staff" value="{{ $ticket->assigned_to_staff }}" id="cc_assigned_to_staff">
                                            <input type="hidden" name="status" value="{{ $ticket->status }}" id="cc_status">
                                            <input type="hidden" name="priority" value="{{ $ticket->priority }}" id="cc_priority">
                                            <input type="hidden" name="assigned_to" value="{{ $ticket->assigned_to }}" id="cc_assigned_to"> -->
                                                               @php
                                                                $description = (old('body')) ? old('body') : "";
                                                                $description = $description."<br />".Auth::user()->userSignature;
                                                                @endphp
                                                                <textarea class="form-control tinymce" id="exampleFormControlTextarea1" placeholder="Type your text message here..." name="body" id="body">@if (isset($reply_draft))<p> {{ $reply_draft->body }}</p>@else{{ $description }}@endif</textarea>
                                                                <span id="textarearemaindynamic"></span>
                                                                @if ($errors->has('body'))
                                                                <span class="help-block">
                                                    <strong>{{ $errors->first('body') }}</strong>
                                                </span>
                                                                @endif
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12 form-group attachment-label"><label for="option_one">Attachments</label></div>
                                                    <div class="choose-from-taigha-panel">
                                                    <div class="col-sm-10 ticket-attachment panel multiplefileblock newattachmentpanel" >
                                                        <div class="form-group {{ $errors->has('attachments.*') ? ' has-error' : '' }}">
                                                            
                                                             
                                                             <div class="attachementspanel__wrap">
                                                                
                                                             <div id="upload_dynamic_files_here"></div>
                                                             <p class="ptest1">Drag Files Here</p>
                                                             <p class="ptest2">or</p>
                                                                <input type="file" name="attachments[]" class="form-control attachments multiplefile newattachmentfile last" id="attachments_1" data-init="1"  value="" multiple="multiple">
                                                                </div> 
                                                                 <div class="uploaded-image-preview" id="upload_image_preview">
                                                                           <div id="exampleFormControlTextarea1_attachemnt"></div>
                                                                           
                                                                                    <div id="upload_dynamic_images_here"></div>
                                                                </div>
                                                                 <!-- <span class='cursor-pointer display-none' onclick="removeAttached()" id="attachments_remove_1"><i class='fa fa-trash-o' aria-hidden='true'></i></span> -->
                                                                 <input type="hidden" name="removedImages" id="removedImages" value="">
                                                                 <div id="mail_attachment_target"></div>

                                                            @if ($errors->has('attachments'))
                                                            <span class="help-block">
                                                                <strong>{{ $errors->first('attachments') }}</strong>
                                                            </span>
                                                            @endif
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-2 choose-from-taigha-a-panel">
                                                    <a class="advanced-search-a choose-from-taigha-a"  href="javascript:;" data-toggle="modal" data-target="#globalMediaLib-modal"  onclick="resetGlobalMediaLib('exampleFormControlTextarea1')">Choose from Taigha</a>
                                                    </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <button type="submit" class="btn-blue send-text-btn text-uppercase" id="ticketreplybutton" onclick="return validatemandatory(); return checkChecklistStatus();">Send</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                @if( in_array($ticket->ticket_type, ['customer', 'partner','hiring']) && $ticketUser && \App\Helpers\CustomHelper::getgeneral("website_has","privileges_hiring_text") == 1)
                <div class="form-container content-container chat-panel txt-border">
                    <div class="mail-section cus-table-header mail-section-ma p-0 cursor-pointer " id="textmessage_allmessages_header" onclick="CEToggle('textmessage_allmessages');gotoLastSMS();draft_change('Text Message')">
                        <div class="col-12 col-md-12">
                            <div class="twilio-message-reply-container">
                                <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/textmessage-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/textmessage-white.svg') }}">
                                @if($ticket->is_job_applicant == 1)	
                                <h2 id="focus_sms_here">HIRING TEXT MESSAGES  ({{ count($twilioMessages) }})</h2>	
                            @else	
                                <h2  id="focus_sms_here">TEXT MESSAGES  ({{ count($twilioMessages) }})</h2>	
                            @endif
                                </div>
                            </div>
                            <div class="expand-collapse-panel">
                            </div>
                        </div>
                    </div>
                    <div class="chat-outer-container display-none" id="textmessage_allmessages">
                        <div class="view-notes-container">
                            @php
                            if($ticket->ticket_type == 'hiring'){	
                                $totalNumbers = $ticketUser->getCandidatePhoneNumbers($ticketUser->id);	
                            }else{	
                                $totalNumbers = $ticketUser->getUserPhoneNumbers($ticketUser->id);	
                            }
                            @endphp
                            @php
                            $showOptin = 1;
                            $optinMethod = "";
                            if($optinRecord){
                                if($optinRecord->optin_optout == "stop" && $optinRecord->method != 'default'){
                                    $showOptin = 0;
                                    $optinMethod = $optinRecord->method;
                                }
                            }
                            @endphp
                            
                            @if($twilioMessages->count() > 0)
                            <div class="chat-inner-container">
                                @foreach($twilioMessages as $message)
                  
                                <div class="col-12 col-lg-12  message-row {{  $message->sms_type }} ">
                                    <div class="{{  $message->sms_type }}">
                                        <div class="message-container">
                                            <p class="message-body">{!! nl2br($message->body) !!}</p>
                                            @if($message->sms_type == 'outgoing')
                                            <p class="message-author">Sent By {{ ($message->creator) ? $message->creator->name : '' }} at {{ \App\Helpers\CustomHelper::dateFormatUS("$message->created_at") }}</p>
                                            @if($message->sms_delivery_status)
                                            <p class="message-author">Status: <span class="{{ $message->sms_delivery_status }}">{{ $message->sms_delivery_status }}</span></p>
                                            @endif
                                            @endif
                                            @if($message->sms_type == 'incoming')
                                            <p class="message-date-formatted">Received at {{ \App\Helpers\CustomHelper::dateFormatUS("$message->created_at") }}</p>
                                            @endif
                                        </div>
                                    </div>
                                </div>
                                @endforeach
                            </div>
                            @endif
                            @if(count($totalNumbers) > 0 || count($inactiveNumbers) > 0)
                            <div class="user-numbers text-message-homesearch" style="margin-top: 15px;">
                                <label for="user_number">Conversation with</label>
                                <select name="user_number" id="user_number" class="select-two-dd" onchange="loadMessageByNumber(this.value)">
                                    <option value="">Select</option>
                                    @if(count($totalNumbers) > 0)
                                    @foreach($totalNumbers as $name => $totalNumber)
                                    <option value="{{ $totalNumber }}" {{ ( $textMessageCurrentNumber ==  $totalNumber ) ? 'selected' : '' }}>{{ $totalNumber }} - {{ str_replace('-', ' ', ucfirst($name)) }}</option>
                                    @endforeach
                                    @endif
                                    @if(count($inactiveNumbers) > 0)
                                    @foreach($inactiveNumbers as $name => $inactiveNumber)
                                    <option value="{{ $inactiveNumber }}" {{ ( $textMessageCurrentNumber ==  $inactiveNumber ) ? 'selected' : '' }}>{{ $inactiveNumber }} - Inactive</option>
                                    @endforeach
                                    @endif
                                </select>
                            </div>
                            @if(count($twilioMessages) > 0)
                            <div class="margin-below-selectbox"></div>
                            @endif
                            @endif
                            <form class="cd-form tickets-view-textmessages {{ $ticket->status == 'closed' ? 'display-none' : '' }}" method="POST" action="{{ URL::action('Admin\\TwilioController@sendSms') }}" id="profile_update_sendSms" enctype='multipart/form-data'>
                                <input type="hidden" name="sms_twilio_user_id" class="form-control" id="form_sms_twilio_user_id" readonly="" value="{{ ($ticketUser) ? $ticketUser->id  : 0 }}">
                                <input type="hidden" name="sms_twilio_phone_number" class="form-control" id="form_sms_twilio_phone_number" readonly="" value="{{ $textMessageCurrentNumber }}">
                                <input type="hidden" name="sms_twilio_tm_type" class="form-control" id="form_sms_twilio_tm_type" readonly="" value="tickets">
                                <input type="hidden" name="sms_twilio_tm_id" class="form-control" id="form_sms_twilio_tm_id" readonly="" value="{{ $ticket->id }}">
                                <input type="hidden" name="ticket_type" value="{{$ticket->ticket_type }}">
                                <div class="reply-container reply-panel" style="padding:0; padding-right: 0;">
                                    <div class="form-group row  {{ $optinSuccess == 0 ? 'optin-not-verified' : '' }} ">
                                        <div class="col-12 text-message-homesearch p-0">
                                            <input type="hidden" name="select_template_type" id="select_template_type_modal" value="text_messages">
                                            <select class="select-two-dd form-control" name="select_template" id="select_template_modal_email" onchange="loadTemplate(this.value, 'form_sms_twilio_message', 'html', 'tickets-view-textmessages')">
                                                <option value="">Select template</option>
                                                @if(count($textTemplates) > 0)
                                                @foreach($textTemplates as $emailTemplate)
                                                <option value="{{ $emailTemplate->id }}">{{ $emailTemplate->id }} - {{ $emailTemplate->title }}</option>
                                                @endforeach
                                                @endif
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group text-message-homesearch  {{ $optinSuccess == 0 ? 'optin-not-verified' : '' }} ">
                                        @php
                                        $descriptionmodelsig = (old('sms_twilio_message')) ? old('sms_twilio_message') : Auth::user()->userMessageSignature;
                                        if($selectedtextTemplate){
                                            $descriptionmodelsig = $selectedtextTemplate->body;
                                        }
                                        if($showOptin == 0){
                                            $descriptionmodelsig = config("toptech.optin_optout.".$optinMethod);
                                        }
                                        @endphp
                                        <textarea class="form-control limit-three-hundard-characters" placeholder="Type your text message here..." onkeyup="save_draft_common($(this).val())" name="sms_twilio_message" id="form_sms_twilio_message">{{ $txtmsg_draft ? $txtmsg_draft->body : $descriptionmodelsig }}</textarea>
                                        <p class="remain_text_limit_panel"><span class="remain_text_limit">1599</span> characters left </p>
                                    </div>
                                     @if($optinSuccess > 0)
                                    <div class="form-group">
                                            <label for="tags">MMS</label>
                                            <div class="mms_attachment_panel text-message-homesearch">
                                                <p class="ptest1">Drag Files Here</p>
                                                <p class="ptest2 wrap">or</p>
                                                <input type="file" class="form-control mms_attachment" id="mms"  placeholder="Mms" name="mms" value="{{ old('mms') }}">
                                            </div>
                                    </div>
                                    @endif
                                    {{-- <div class="form-group">
                                        <input type="text" name="sms_twilio_tag" class="form-control text-message-homesearch" id="form_sms_twilio_tag" placeholder="Tags">
                                    </div> --}}
                                    @if(@$menuPrivilagesAll['text_messages'] == 'write' && $showOptin == 1)
                                    <button type="submit" class="btn-blue send-text-btn text-uppercase viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}" id="messagereplybutton" onclick="hideButton('messagereplybutton')">{{ $optinSuccess > 0 ? 'Send' : 'Request opt-in' }}</button>
                                    @endif
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                @endif
                <!-- hiring Documents Start -->	
                @if($ticket->is_job_applicant == 1)	
                <div class="form-container content-container chat-panel">	
                    <div class="row">	
                        <div class="col-12 col-md-12" id="scroll_to_documents">	
                            <div class="cus-table-header cursor-pointer" id="documents_toggle_panel_header"  onclick="CEToggle('documents_toggle_panel'); tabOptions('tab/filters/resume', 't_f_customer_documents', 'candidate', 'resume'); ">	
                                <input type="hidden" class="hiddenappendvalues" name="candidate_id" value="{{ $ticket->candidate_id }}">	
                                <input type="hidden" name="t_f_customer_documents_h" id="t_f_customer_documents_h" value="0">	
                                <div class="icon-title">	
                                    <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/m-documents.svg') }}">	
                                    <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/m-documents-white.svg') }}"> 	
                                    <h2>Hiring Documents({{ count($candidatedocument) }}) </h2>	
                                </div>	
                                <div class="cus-hdr-rht">	
                                    <div class="cus-doc">       	
                                        
                                        <a title="Upload" class="click-call client-action call-customer-button custom-a" href="{{ URL::action('Admin\\CandidateController@documentcreate',  [ 'candidate_id='.$ticket->candidate_id ]) }}">
                                            <span>Upload Hiring Document</span>
                                            <i class="fa fa-upload custom-icon"></i>
                                        </a>
                                    
                                    </div>	

                                    
                                </div>	
                            </div>	
                            <div class="table-responsive-jobs display-none" id="documents_toggle_panel">	
                                <div class="t_f_customer_documents" id="t_f_customer_documents"></div>   	
                            </div>	
                        </div>	
                    </div>	
                </div>	
            @endif	
            <!-- hiring Documents End --> 	
            <div class="form-container content-container chat-panel" id="notes_whole_block">
                    <div class="row">
                        <div class="col-12 col-md-12" id="scroll_to_relatednotes">
                            <div class="cus-table-header cursor-pointer" id="ec_notescontainer_header" 
                            onclick="CEToggle('ec_notescontainer'); tabOptions('tab/filters/notes', 't_f_ticket_notes', 'tickets', 'notes'); " >
                            <input type="hidden" name="t_f_ticket_notes_h" id="t_f_ticket_notes_h" value="{{ $notesCount > 0 ? 0 : 1 }}">
                            <div class="icon-title">
                                <img class="black icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/notes-black.svg') }}">
                                <img class="white icon-title-icon" width="35" src="{{ url('adminasset/img/navIcon/notes-white.svg') }}">
                                <h2>Notes ({{ $notesCount }})</h2>
                                </div>
                                <div class="cus-hdr-rht">
                                </div>
                            </div>
                            <div class="display-none" id="ec_notescontainer">
                            <div id="t_f_ticket_notes"></div>
                            <div class="reply-form-notes pt-2 border-0" id="expandAllNotes_form">
                                <form action="{{ URL::action('Admin\\NoteController@saveNote') }}" method="POST" enctype="multipart/form-data" id="activity_note_reply_form">
                                    <?php 
                                        $userId =  ($ticket->customer) ? $ticket->customer->id : 0;
                                        $propertyId = ($ticket->assignedchild) ? $ticket->assignedchild->id : 0;
                                    ?>
                                    {{ csrf_field() }}
                                    <h5 class="addnoteBtn panelwrapper viewedbtncls {{$ticket->status == 'closed' ? 'hiddenbtn' :'' }}"><a href="javascript:;" class="btn-blue addnote-button" onclick="draft_change('Notes')" id="tg_add_note" >Add note</a></h5>
                                    <div class="addnote-description" style="display: none">
                                        <div class="form-group row" id="ticket_add_note_textarea">
                                            <div class="col-12">
                                                <input type="hidden" name="note_for" value="ticket">
                                                <input type="hidden" name="user_id" value="{{ $userId }}">
                                                <input type="hidden" name="child_id" value="{{ $propertyId }}">
                                                <input type="hidden" name="ticket_id" value="{{ $ticket->id }}">
                                                <input type="hidden" name="mail_id" value="0">
                                                    <div class="col-sm-3 row panel xpanel-cr mb-3 pl-0">
                                                    <!--<label class="m-0 col-12 col-lg-5 col-form-label align-label-create-tic" for="priority">Templates 2</label>-->
                                                    <input type="hidden" name="select_template_type"  id="select_template_type" value="email_or_tickets" >
                                                    <select class="send-pma-users select-two-dd col-12 col-lg-7" name="select_template" id="select_template"  onchange="loadTemplate(this.value, 'note', 'note-body', 'email-mail-create')" >
                                                        {{-- id, htmlid, type, className --}}
                                                    {{-- nameofthetextarea, classofthetextarea, classofform --}}
                                                    <option value="">Select Template</option>
                                                    @if(count($note_templates) > 0) 
                                                    @foreach($note_templates as $note_template)
                                                    <option value="{{ $note_template->id }}">{{ $note_template->id }} - {{ $note_template->title }}</option>
                                                    @endforeach
                                                    @endif
                                                    </select>
                                                    </div>
                                                <textarea class="form-control auto-height note-body notescheckempty" name="note" id="activity_note_reply_form_note" class="activity_note_reply_form_note" rows="5" onkeyup="save_draft_common($(this).val())" spellcheck="true" placeholder="Add your notes">{{$notes_draft ? $notes_draft->body : ''}}</textarea>
                                            </div>
                                        </div>
                                        <div class="form-group row tckt-Btns m-3">
                                          <button type="submit" class="btn-blue mr-2" name="saveandnotify"  onclick="return saveTicketNote()" id="ticket_add_note_button1" >Save & Notify</button>
                                          <button type="submit" class="btn-blue mr-2" name="save"  onclick="return saveTicketNote()" id="ticket_add_note_button" >Save</button>
                                          <button type="button" class="btn-blue" name="save"  onclick="$('#tg_add_note').click();" >Cancel</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                @if($ticket->is_job_applicant != 1)
<div class="form-container content-container chat-panel" id="related_tickets_whole_block">
    <div class="row">
        <div class="col-12 col-md-12" id="scroll_to_related_tickets">
            
            <div class="cus-table-header cursor-pointer" id="ec_related_ticketscontainer_header" onclick="getRelatedTickets({{$ticket->id}});" >
                <div class="icon-title">
                                <img class="black icon-title-icon h-fix" width="35" src="{{ url('adminasset/img/navIcon/ticket-black.svg') }}">
                                <img class="white icon-title-icon h-fix" width="35" src="{{ url('adminasset/img/navIcon/ticket-white.svg') }}">
                <h2>related tickets ({{$related_tickets_count}})</h2>
                </div>
                <div class="cus-hdr-rht">
                </div>
            </div>
            <div class="display-none" id="ec_related_ticketscontainer">
                
            </div>
        </div>
    </div>
</div>

@endif
        </div>
    </div>
</div>
</div>
<!-- Modal -->
<!-- Modal -->

<!-- Ticket Start -->
<div class="modal fade show default-modal width-eighty-percentage " id="ticketEdit-modal">
        <div class="modal-dialog animated ">
            <div class="modal-content">
                <div class="modal-header">
                    <ul class="nav nav-tabs addnote-navtabs" id="editticket-tab" role="tablist">
                      <li class="nav-item">
                         <a class="nav-link active" id="md-one-tab" aria-controls="md-one" aria-selected="true">Edit</a>
                     </li>
                 </ul>
                 <button type="button" class="close" data-dismiss="modal" id="close_ticket_activity">[close]</button> 
             </div>
             <div class="modal-body">
                <div class="tab-content addnote-tab-content" id="editTicketTabContent">
                  <div class="tab-pane fade show active" id="md-oneticket" role="tabpanel" aria-labelledby="md-one-tab">
                    <form action="{{ URL::action('Admin\\TicketsController@updateEmail', [$ticket->id, $ticketDetail->id]) }}" method="POST" enctype="multipart/form-data" id="edititkcet_form">
                      {{ csrf_field() }}
                         @php
                            $passName = "";
                            if($ticket->ticket_type == 'partner') {
                                $passName = ($ticket->partner) ? $ticket->partner->lastusername : '';
                            } else {
                                $passName = ($ticket->customer) ? $ticket->customer->lastusername : '';
                            }
                            if($passName != "") {
                                $tA = explode(":", $ticket->default_subject);
                                if(@$tA[1] != "") {
                                    $tA = explode("-", @$tA[1]);
                                    $passName = @$tA[0] ? trim($tA[0]) : $passName;
                                }
                               
                            }
                         @endphp

         <!--<div class="col-12 col-sm-12 row margin-bottom-20">-->
         <!--                    <div class="row">-->
         <!--                        <div class="col-12 d-flex">-->
         <!--                       @if($passName)-->
         <!--                       <label class="m-0 col-12 col-lg-6 col-form-label" for="madrill_mail_to">Name</label>-->
         <!--                       <input type="text" class="form-control col-12 col-lg-6 ticket_edit_subject"  name="pass_name" value="{{ $passName }}">-->
         <!--                       @else-->
         <!--                       <input type="hidden" class="form-control col-12 col-lg-6 ticket_edit_subject"  name="pass_name" value="">-->
         <!--                       @endif-->
         <!--                       </div></div>-->
         <!--                       <div class="row">-->
         <!--                       <div class="col-12 d-flex"><label class="m-0 col-12 col-lg-6 col-form-label" for="madrill_mail_to">Subject</label>-->
         <!--                       <input type="text" name="ticket_edit_subject" class="form-control col-12 col-lg-6 ticket_edit_subject" id="ticket_edit_subject" placeholder="Subject" value="{{ $ticket->subject }} ">-->
         <!--                       </div></div>-->
                                
         <!--               </div> -->
                        
                         <div class="col-12 col-sm-12">
                             <div class="row">
                                 <div class="col-12 modal-class">
                                @if($passName)
                                <label class="col-sm-6 col-lg-4 modal-label" for="madrill_mail_to">Name</label>
                                <input type="text" class="form-control col-sm-6 col-lg-8 modal-input"  name="pass_name" value="{{ $passName }}">
                                @else
                                <input type="hidden" class="form-control col-sm-6 col-lg-8 modal-input"  name="pass_name" value="">
                                @endif
                                </div></div>
                                <div class="row">
                                <div class="col-12 modal-class"><label class="col-sm-6 col-lg-4 modal-label" for="madrill_mail_to">Subject</label>
                                <input type="text" name="ticket_edit_subject" class="form-control col-sm-6 col-lg-8 modal-input" id="ticket_edit_subject" placeholder="Subject" value="{{ $ticket->subject }} ">
                                </div></div>
                                
                        </div>    
                        <div class="col-12 col-sm-12 row m-0 ticket_editbody">
                                <textarea class="form-control tinymce" name="ticket_edit_body" id="ticket_edit_body" class="ticket_edit_body" rows="5">{{ $ticketDetail->body }}</textarea>
                        </div>  
                        <div class="form-group row ticket_editbody m-0 p-0">
                          <button type="submit" class="btn-blue activitylog-reply-btn"  id="edit_ticket_button" style="margin-left: 20px;width: 160px;">Update and Notify</button>
                          <button class="btn-blue activitylog-reply-btn" id="updateEmailNoNotify" style="margin-left: 20px;width: 160px;">Update</button>
                        </div>
                      </div>
                    </form>
                  </div>

                </div>
              </div>
        </div>
    </div>
</div>
<!-- Ticket End -->


<!-- QTO Start -->
<div class="modal fade show default-modal width-eighty-percentage " id="qtoEdit-modal">
        <div class="modal-dialog animated ">
            <div class="modal-content">
                <div class="modal-header">
                    <ul class="nav nav-tabs addnote-navtabs" id="qtoticket-tab" role="tablist">
                      <li class="nav-item">
                         <a class="nav-link active" id="md-one-tab" aria-controls="md-one" aria-selected="true">Redesignate the Home Search ticket </a>
                     </li>
                 </ul>
                 <button type="button" class="close" data-dismiss="modal" id="close_qto_activity">[close]</button> 
             </div>
                <div class="modal-body">
                    <div id="dynamic_qto_tickets"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- QTO End -->

@endsection
<!-- Javascript files-->
@section('js')
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript">
 
 $(document).ready(function () {
    // Handler for .ready() called.
    $('html, body').animate({
        scrollTop: $('#all_ticket_email_messages_header').offset().top -175
    }, 'fast');
});

var staffaccess = $("select.ticketaccess[name='accessible_users[]']").map(function(){return $(this).val();}).get();
$('#accessible_users').on('select2:unselect', function(evt) {
    var data = evt.params.data;
    var values = $("input[name='checklist_assigned[]']").map(function(){return $(this).val();}).get();
    if($.inArray(data.id , values) >= 0){
        alert(''+data.text+' have a task in this ticket. You are not allowed to remove it from the access list.');
        $(this).val(staffaccess).trigger('change');    
    }       
});

$("#hide_ticketid").click(function() {
    if($("#hide_ticketid").prop('checked') == true){
        $("#hide_ticketid").prop('checked', true);
        $("#hide_ticketid").val('1');
        $(".topupdatebuttonforticket").removeClass("disabled");
    }
    else {
        $("#hide_ticketid").prop('checked', false);
        $("#hide_ticketid").val('0');
        $(".topupdatebuttonforticket").removeClass("disabled");
    }
});

$("#hide_ticketid_bottom").click(function() {
    if($("#hide_ticketid_bottom").prop('checked') == true){
        $("#hide_ticketid_bottom").prop('checked', true);
        $("#hide_ticketid_bottom").val('1');
    }
    else {
        $("#hide_ticketid_bottom").prop('checked', false);
        $("#hide_ticketid_bottom").val('0');
    }
});


function validatemandatory() {
      $("#group_validation").removeClass('has-error');
      $("#staff_validation").removeClass('has-error');
      $("#company_validation").removeClass('has-error');
    //   if($("#property_id_bottom").val() == 0 && $("#ticket_hide_type").val() == 'customer'){
    //     $("#company_validation").addClass('has-error');
    //     alert("Children is mandatory");
    //     return false;
    //   }
      if($("#assigned_to_bottom").val() == 0){
        $("#group_validation").addClass('has-error');
        alert("Group and Staff are mandatory");
        return false;
      }
      if($("#assigned_to_staff_bottom").val() == 0){
        $("#staff_validation").addClass('has-error');
        alert("Staff is mandatory");
        return false;
      }
      hideButton('ticketreplybutton');
}
function email_show(){
    $('.email-hide').show();
    $('#mail-bubble').hide();
    $('html, body').animate({
        scrollTop: $('#replyticketcontainer').offset().top -50
    }, 'fast');
}
function draft_change(val){
    if(val == 'Notes' || val == 'Text Message'){
        $('#hidden_eloquent').val(val);
        $('#hidden_type').val('Ticket');
    }else{
        $('#hidden_type').val(val);
    }
}
$('.noteshidebtn').click(function (){
    var notesallRequired = true;
        $('.notescheckempty').each(function() {
            if ($(this).val() == "" ) {
                notesallRequired = false;
                
            }
        });
if(notesallRequired){
    $('.noteshidebtn').hide();
}
     });
$('.hidebtn').click(function (){
    var isValid = true;
    var allRequired = true;
        $('.checkempty').each(function() {
            if ($(this).val() == "" ) {
                allRequired = false;
            }
        });
if(allRequired){
    $('.hidebtn').hide();
}
     });
$(document).ready(function(){
  $('.openblank a').attr('target', '_blank');
    $('.save-button').attr('disabled',true);
    $('.val').keyup(function(){
        if($(this).val().length !=0){
            $('.save-button').attr('disabled', false); 
        }else
            $('.save-button').attr('disabled',true);
        })
});
$('#daterangepicker_inputsingle').on('click', function () {
    $('.save-button').prop('disabled', !$(this).val());
}).trigger('change');

$('.select-two-dd').on('change', function () {
    $('.save-button').prop('disabled', !$(this).val());
})
// });
/*related tickets*/
    function openRelatedTicketInput(){
        $('#add-related-ticket-div').removeClass('display-none');
    }
    function addRelatedTicket(id){
        var related_ticket_id = $('#related_ticket_id').val();
        $.ajax({
            url: "{{route('addRelatedTicket')}}",
            method: 'POST',
            data: {'ticket_id':id, 'related_ticket_id': related_ticket_id},
            success: function(data) {
                console.log(data);
                alert(data.response);
                CEToggle('ec_related_ticketscontainer');
                getRelatedTickets(id);
            },
            error: function(e) {
                console.log(e);
            }

        });
    }
    function getRelatedTickets(argument, closed_tickets='no') {
        $.ajax({
            url: "{{route('getRelatedTickets')}}",
            method: 'POST',
            data: {'ticket_id' : argument, 'closed_tickets' : closed_tickets},
            success: function(data){     
                if(closed_tickets == 'no')           
                CEToggle('ec_related_ticketscontainer');
                $("#ec_related_ticketscontainer").html(data);
                $("#ec_related_ticketscontainer button").prepend("<img src='/public/adminasset/img/plus.svg' class='list-content-plus'>");
                if(closed_tickets == 'yes'){
                    $("#include-closed-ticket-button").html("Remove closed tickets");
                    $("#include-closed-ticket-button").attr("onclick", "getRelatedTickets("+argument+", 'www' )");
                }
                // CEToggle('ec_related_ticketscontainer');
            },
            error: function(e){
                // alert(e.toString()+"");
                console.log(e)
            }
        });
        return
    }
    function deleteRelatedTicket(ticket_id, related_ticket_id) {
        $.ajax({
            url: "{{route('deleteRelatedTicket')}}",
            method: 'POST',
            data: {'ticket_id':ticket_id, 'related_ticket_id': related_ticket_id},
            success: function(data) {
                console.log(data);
                alert(data.response);
                CEToggle('ec_related_ticketscontainer');
                getRelatedTickets(ticket_id);
            },
            error: function(e) {
                console.log(e);
            }

        });
    }
    function searchcandidateByTerm(term) {
        if(term == "") {
            $("#candidate_search_results").html("");
            return false;
        }
        $(".popup-loader").show();
        $("#candidate_search_results").show();
        var baseurl = $('meta[name="baseurl"]').attr('content');
            $.ajax({
            url: baseurl+'/admin/candidateglobal-search',
            method: 'GET',
            data: "_token={{ csrf_token() }}&searchTerm="+term,
            success: function(data){
              $("#candidate_search_results").html(data);
              $(".popup-loader").hide();
            },
            error: function(e) {
                    console.log(e);
                    $(".popup-loader").hide();
                }
          });
    }
/* ticketcontacts */
function cloneContact() {
        var id = $("#exisiting_contact_count").val();
        var nextId = parseInt(id) + 1 ;
        $(".popup-loader").show();
        $('#dynamic_contact_here_'+id).load(window.baseUrl+'/admin/ticket/{{ $ticket->id }}/clone/'+nextId+'/contact', function(){
          $(".popup-loader").hide();
          $(".select-two-dd").select2();
          $('.daterangepickerinputsingle').daterangepicker({
            singleDatePicker: true,
            autoUpdateInput: false,
            minDate: "@php $today = date('m/d/y'); echo $today; @endphp"
          }, function(start_date, end_date) {
          });
          $('.daterangepickerinputsingle').on('apply.daterangepicker', function(ev, picker) {
            $(this).val(picker.startDate.format('MM/DD/YYYY'));
          });
          contactCancelBlock();
        });
        $("#exisiting_contact_count").val(nextId);
      }
function contactCancelBlock() {
        $("#conatct_save_cancel_block").show();
      }
/* ticketcontacts */


$("#updateEmailNoNotify").click(function() {
    $(this).closest("form").attr("action", "{{ URL::action('Admin\\TicketsController@updateEmailNoNotify', [$ticket->id, $ticketDetail->id]) }}");   
    $(this).closest("form").submit();  
});
  $(document).ready(function() {
    // pres - load first
    $( document ).ready(function() {
        var list = $("ul#sortable"),
        origOrder = list.children();
        var i, checked = document.createDocumentFragment(),
            unchecked = document.createDocumentFragment();
        for (i = 0; i < origOrder.length; i++) {
            if (origOrder[i].getElementsByClassName("closed")[0]) {
                checked.appendChild(origOrder[i]);
            } else {
                unchecked.appendChild(origOrder[i]);
            }
        }
        list.append(unchecked).append(checked);

        $('#sortable .task-list-panel').each(function(index, value) {
                var li_id = $(this).attr("id");
                $("#"+li_id+"_position").prop("value", index+1);
                var element = document.getElementById(li_id+"_position");
                element.setAttribute('value', index+1)
            });
});
    // pres
    @if(app('request')->get('tab') == 'text_message')
        focusSmS();
        setTimeout(() => {
            var height = 0;
            $('.chat-inner-container .message-row').each(function(i, value){
                height += parseInt($(this).height());
            });
            height += '';
            $('.chat-inner-container').animate({scrollTop: height}, 0);
        }, 100);

    @elseif(app('request')->get('tab') == 'reply')
        focusReply();
        setTimeout(() => {
            $(".reply-ticket-title").click();
            focusReplyActivity();
            editorById('body',draft_change('Reply'));
            $('html, body').animate({
                scrollTop: $("#textarearemaindynamic").offset().top - 200
            }, 0);
        }, 100);
        @elseif(app('request')->get('user_number') != '')
      focusSmS();
    @elseif(app('request')->get('tab') == 'rentallistingsummary')
      CEToggle('rental_listing_detailcontainer'); editRentalListingDetail();
    @elseif(app('request')->get('tab') == 'devsummary')
      CEToggle('all_ticket_email_messages');
      CEToggle('ec_dev_detailscontainer'); editDevDetail();
    @elseif(app('request')->get('tab') == 'leasingsummary')
      CEToggle('ec_leasing_detailscontainer'); editLeasingDetails();

      @elseif(app('request')->get('tab') == 'admissionsummary')
      CEToggle('ec_orc_detailscontainer'); vieworcDetails();
    @elseif(app('request')->get('tab') == 'workordersummary')
      CEToggle('ec_work_order_detailscontainer'); editWorkOrderDetails();  
    @elseif(app('request')->get('tab') == 'transactionsummary')
      CEToggle('ec_transaction_detailscontainer'); viewTransactionDetails(); 
    @elseif(app('request')->get('tab') == 'tasks')
        focusChecklist();
        tabOptions('tab/filters/tasks', 't_f_ticket_tasks', 'tickets', 'tasks');
    @elseif(app('request')->get('tab') == 'activity' || app('request')->has('activity_page'))
        focusActivity();
        tabOptions('tab/filters/activities', 't_f_ticket_activites', 'tickets', 'activity');
    @elseif(app('request')->get('section') == 'mail')
        CEToggle('all_ticket_email_messages');
        focusReply();
    @elseif(app('request')->get('section') == 'note')
        CEToggle('all_ticket_email_messages');
        focusNotes();
        tabOptions('tab/filters/notes', 't_f_ticket_notes', 'tickets', 'notes'); 
    @elseif(app('request')->get('tab') == 'contacts')
        focusContacts();
    @endif
});

//   $( function() {
//     $( "#sortable" ).sortable({
//       containment: "parent",
//       start: function( event, ui ) { },
//       classes: {
//         "ui-sortable": "highlight",
//         cursor: "move",
//       },
//       update: function( event, ui ) {
//             Dropped();
//           }
//     });
//     $( "#sortable" ).disableSelection();
//   } );
if($(window).width() >= 600){
$( function() {
    $( "#sortable" ).sortable({
      containment: "parent",
      start: function( event, ui ) { },
      classes: { "ui-sortable": "highlight", cursor: "move", },
      update: function(e,ui) {
        showSaveCancelBlock();
        ui.item.addClass("this");
        $('#sortable .task-list-panel').each(function(index, value) {
                var li_id = $(this).attr("id");
                $("#"+li_id+"_position").prop("value", index+1);
                var element = document.getElementById(li_id+"_position");//$("#"+li_id+"_position");
                element.setAttribute('value', index+1)
            });
        },
      stop: function(event, ui) {
            ui.item.addClass("this");
        }
    });
    $( "#sortable" ).disableSelection();
  } );
}

function Dropped() {
    var contentOrder = [];
  $(".draggable").each(function(){
    //var p = $(this).position();
    contentOrder.push($(this).attr('data-id'));
  });
  $('#content_order').val(contentOrder.join(','));
}
function saveTicketNote() {
    note = $.trim( $("#activity_note_reply_form_note").val() );
    $("#ticket_add_note_textarea").removeClass('has-error');
    if(note == "") {
            $("#ticket_add_note_textarea").addClass('has-error');
            $("#activity_note_reply_form_note").focus();
            return false;
    }
    $("#ticket_add_note_button1").hide();
    $("#ticket_add_note_button").hide();
    return true;
}

function topTobottom() {
    $('html, body').animate({
        scrollTop: $(".list-content ul li:last-child").offset().top - 200
    }, 0);
}
function checkTobottom() {
    $('html, body').animate({
        scrollTop: $("#save_checklist_textarea").offset().top - 500
    }, 0);
}
function checkTobottom() {
        $('html, body').animate({
        scrollTop: $("#CustomScrollBottom").offset().top - 500
    }, 0);
}
function toggleActivity(id) {
    $("#activityContentarea_"+id).slideToggle();
    if ($("#activityContentarea_tag_"+id).text() == 'Expand') {
        $("#activityContentarea_tag_"+id).html("<span>Collapse</span>");
        $("#activityContentarea_tag_"+id).addClass("panelOpen");
        getActivityRow(id);
    } else {
        $("#activityContentarea_tag_"+id).html("<span>Expand</span>");
         $("#activityContentarea_tag_"+id).removeClass("panelOpen");
    }

}

function toggleTicketDescription(){
        if($(".purgex").hasClass('less')) {
                 $(".purgex").removeClass('less');
                $(".purgex").addClass('more');
                $(".ticket-top-stripped-content").hide();
                $(".pureyad").slideDown();
        } else {
            $(".purgex").removeClass('more');
            $(".purgex").addClass('less');
            $(".ticket-top-stripped-content").show();
                $(".pureyad").slideUp();
        }
    }

    $(document).ready(function(){

    

var text = $('.pureyad'),
     btn = $('.purgex'),
       h = text[0].scrollHeight; 

        if(h > 120) {
        btn.addClass('less');
    }
   /* btn.click(function(e) 
    {
    e.stopPropagation(); 

    if (btn.hasClass('less')) {
        btn.removeClass('less');
        btn.addClass('more');
        //btn.text('');

      text.animate({'height': h});
  } else {
            btn.addClass('less');
            btn.removeClass('more');
            //btn.text('Show more');
            text.animate({'height': '50px'});
        }  
    });*/

});
$(document).ready(function() {
    $(".select-two-dd").select2();
    $('.list-content ul li:last-child').attr('id', 'list-content-lastchild');
})

function addAnotherAtaachment() {
    target = $(".attachment-panel:last").clone();
    target.find('.mail-remove-attachment').remove();
    target.find('.initial-attachment').remove();
    target.find('.attachments').val('');

    count = parseInt(target.attr('data-init')) + 1;
    id = 'attachments_' + count;
    clone = target.attr('data-init', count).attr('id', id).val("");
    $('#mail_attachment_target').before(clone);
    passOnclick = "onclick=removeAttachment('" + count + "')";
    $("#" + id + " .attachments").after("<span title='Remove' class='mail-remove-attachment cursor-pointer' " + passOnclick + " id='attachments_remove_" + count + "'><i class='fa fa-trash' aria-hidden='true'></i></span>");;
    $("#" + id + " .attachments").val('');

    console.log(clone.attr('data-init'));
}

function removeAttachment(id) {
    $("#attachments_" + id + " , #attachments_remove_" + id).remove();
}

function toggleAccordian(id) {
    //$(".ticket-panel").removeClass('full-height');
    var className = $.trim($("#ticket_history_" + id + " .accordian-panel i").attr('class'));
    //$(".ticket-panel .accordian-panel i").attr('class', 'fa fa-plus');
    if (className == 'fa fa-plus') {
        $("#ticket_history_" + id + " .accordian-panel i").attr('class', 'fa fa-minus');
        $("#ticket_history_" + id).addClass('full-height');
    } else {
        $("#ticket_history_" + id + " .accordian-panel i").attr('class', 'fa fa-plus');
        $("#ticket_history_" + id).removeClass('full-height');
    }


}
 
$(document).ready(function () {
   $(".ticket_panel_desc").css({display: 'none'});
    $("#mob-ticket-reply-click-span").text('+').fadeIn(); 
    $("#mob-ticket-reply-click").click(function () {
        //$(".ticket_panel_desc").slideToggle();
        $('.ticket_panel_desc').slideToggle(function () {
         if ($(this).is(':visible')){
             $(this).css({display: 'flex'});
         }
     });
        $("#mob-ticket-reply-click-span").fadeOut(function () {
            $("#mob-ticket-reply-click-span").text(($("#mob-ticket-reply-click-span").text() == '+') ? '-' : '+').fadeIn();
        })
    });
     
});



$(document).ready(function () {
    $('body').on('click', '#act-filter-click', function() {
        $('.activity_filter_block_mobile').fadeToggle(function () {
         if ($(this).is(':visible')){
             $(this).css({display: 'flex'});
         }
        });
        $("#act-filter-span").fadeOut(function () {
            $("#act-filter-span").text(($("#act-filter-span").text() == '+') ? '-' : '+').fadeIn();
        })
    });

     
});


$(function() {

    //setTimeout("$('.test').slideToggle('slow');", 1000);
    $(".reply-ticket-title").click(function() {
        if ($(".reply-text-description").css('display') == 'none') {
            $(".reply-button").html('Collapse');
        } else {
            $(".reply-button").html('Reply');
        }
        $(this).next(".reply-text-description").slideToggle("slow").siblings(".test:visible").slideUp("slow");
        $(this).toggleClass("current");
        $(this).siblings(".reply-ticket-title").removeClass("current");
    });
});



function focusSmS() {
    $("#textmessage_allmessages").show();
    $("#textmessage_allmessages_header").addClass('header-active');
    $('html, body').animate({
        scrollTop: $("#focus_sms_here").offset().top - 190
    }, 0);
    $("#form_sms_twilio_message").focus();
}

function focusReply() {
    $("#all_ticket_email_messages").show();
    $("#all_ticket_email_messages_header").addClass('header-active');
    $('html, body').animate({
        scrollTop: $("#reply-ticket-form").offset().top - 200
    }, 0);
    $("#exampleFormControlTextarea1").focus();
     if ($(".reply-text-description").css('display') == 'none') {
            $(".reply-ticket-title").click();
            //$("#exampleFormControlTextarea1").focus();
            try  {
                //tinyMCE.get('exampleFormControlTextarea1').focus()
            } catch(err) {
            }
        }
}

function focusReplyActivity() {
    $("#all_ticket_email_messages_header").addClass('header-active');
    $("#all_ticket_email_messages").removeClass('display-none');
     if ($(".reply-text-description").css('display') == 'none') {
            $(".reply-ticket-title").click();
        }
         $('html, body').animate({
            scrollTop: $("#replyticket_tinymce_editor").offset().top - 100
        }, 0);
         //tinyMCE.get('exampleFormControlTextarea1').focus()
}
function focusjobs(){	
    $("#jobs_toggle_panel").show();	
    $("#jobs_toggle_panel_header").addClass('header-active');	
       $('html, body').animate({	
        scrollTop: $("#scroll_to_jobs").offset().top - 190	
    }, 0);	
    tabOptions('tab/filters/jobs', 't_f_customer_jobs', 'candidate', 'jobs');	
    //$("#exampleFormControlTextarea1").focus(); 	
}

function focusActivity(){
    $("#ec_activityhistory_panel").show();
    $("#ec_activityhistory_panel_header").addClass('header-active');
       $('html, body').animate({
        scrollTop: $("#scroll_to_activitylog").offset().top - 190
    }, 0);
    $("#act_textmessage_allmessages").show();
    $("#act_a_expand_collapse_tag").html("Collapse");
    $("#act_form_sms_twilio_message").focus();
    tabOptions('tab/filters/activities', 't_f_ticket_activites', 'tickets', 'activity');

    //$("#exampleFormControlTextarea1").focus(); 
}

function focusChecklist(){
    $("#check_textmessage_allmessages").show();
    $("#check_textmessage_allmessages_header").addClass('header-active');
       $('html, body').animate({
        scrollTop: $("#scroll_to_checklist").offset().top - 190
    }, 0);
    tabOptions('tab/filters/tasks', 't_f_ticket_tasks', 'tickets', 'tasks');

    //$("#exampleFormControlTextarea1").focus(); 
}

function expandAll() {
    if( $("#act_a_expand_collapse_replybox").html() == 'Expand' ) {
          $("#all_ticket_email_messages .ticket-panel .fa").removeClass('fa-plus').addClass('fa-minus');
          $("#act_a_expand_collapse_replybox").html("Collapse");
          $("#all_ticket_email_messages .ticket-panel").addClass('full-height');
      }else {
        $("#all_ticket_email_messages .ticket-panel .fa").removeClass('fa-minus').addClass('fa-plus');
        $("#act_a_expand_collapse_replybox").html("Expand");
        $("#all_ticket_email_messages .ticket-panel").removeClass('full-height');
      }
}

function expandAllNotes() {
    if( $("#act_a_expand_collapse_notesbox").html() == 'Expand' ) {
          $(".notes-grid-panel ").removeClass('full-height').addClass('full-height');
          $(".notes-grid-panel  .right .fa").removeClass('fa-plus').addClass('fa-minus');
          $("#act_a_expand_collapse_notesbox").html("Collapse");
      }else {
        $(".notes-grid-panel ").removeClass('full-height');
        $(".notes-grid-panel  .right .fa").removeClass('fa-minus').addClass('fa-plus');
        $("#act_a_expand_collapse_notesbox").html("Expand");
      }
}

function collapseAll() {
    $("#all_ticket_email_messages .ticket-panel").removeClass('full-height');
    $("#all_ticket_email_messages .ticket-panel .fa").removeClass('fa-minus').addClass('fa-plus');
}

$('#attachments_1 .attachments').on('change', function() {
    $("#attachments_remove_0").show();
})

function removeAttached() {
    $("#attachments_1 .attachments").val('');
    $("#attachments_remove_0").hide();
}

function changeValue(value, id) {
    var htmlId = id;
    if (id == 'cc_assigned_to') {
        getUser(value);
        $('#accessible_users').find('option').remove();
    }
    $(".topupdatebuttonforticket").removeClass("disabled");
    $("#" + id).val(value);
    //updateTopValues(value, id);
    var displayName = "";
    if (id == 'cc_version') {
        $("#cc_version_value .display-name").text(value);
        var displayName = $("#" + value).attr('data-name');
    }
    if (id == 'cc_emails') {
        $("#cc_emails_value .display-name").text(value);
        var displayName = value;
    }
    if (id == 'cc_assigned_to_staff') {
        displayName = $("#user" + value).attr('data-name');
    }
    if (id == 'cc_property_id') {
        displayName = $("#property_" + value).attr('data-name');
    }
    if (id == 'cc_assigned_to') {
        displayName = $("#group" + value).attr('data-name');
    }
    if(id == "cc_emails") {
        showSelect(id)
    } else {
        showSelect(id.replace("cc_", ""))
    }    
    $("#" + htmlId + "_value .display-name").text(displayName);
    $("#" + htmlId + "_value").removeClass(function(index, className) {
        return (className.match(/(^|\s)has-color-\S+/g) || []).join(' ');
    }).addClass('has-color-' + value);
    if(id == 'cc_priority'){
        $("#priorityval").text(value);
    }
    if(id == 'cc_status'){
        $("#statusval").text(value);
    }
    if(id == 'cc_class'){
        $("#classval").text(value);
    }
    /*if(id == 'cc_status') {
        $("#replyticketcontainer").show();
        if(value == 'closed') {
            $("#replyticketcontainer").hide();
        } 
    }*/
    
}

function showSelect(id) {
    $("#" + id).removeClass("pencil_toggle");
    $('.pencil_toggle').hide();
    $("#" + id).toggle();
    $("#" + id).addClass("pencil_toggle");

}

function updateTopValues(value, id) {

    if (value != '') {
        var baseurl = $('meta[name="baseurl"]').attr('content');
        var mytoken = $('meta[name="csrf-token"]').attr('content');
        $.ajax({
            url: baseurl + '/admin/tickets/{{ $ticket->id }}/' + id + '/' + value,
            method: 'POST',
            data: '_token=' + mytoken + '&user_id=' + value,
            success: function(data) {
                console.log(data);
            },
            error: function(e) {
                console.log(e);
            }

        });
    }
}

function checkChecklistStatus() {
    if( ( $("#onprocesscheckedlists").val() != $("#completedcheckedlists").val()) && $("#status_bottom").val() == 'closed') {
        $(".topupdatebuttonforticket").removeClass('disabled').addClass("disabled");
        alert("You are not allowed to close the ticket until all the tasks are marked complete");
        $("#ticketreplybutton").show();
        return false;
    }
    // alert();
    var returned = true;
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >';
    $("#dev_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('editDevDetail', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    async: false,
    success: function(data){
          $a = data;
          
          var b = $a.split('"root_cause_analysis">').pop().split('</textarea>')[0];
        //   console.log($("#class").val());
          if(b == "" &&  $("#class").val() == "bug" && $("#status_bottom").val() == "closed"){
            $(".topupdatebuttonforticket").removeClass('disabled').addClass("disabled"); 
            alert("Please fill in the RCA field before closing the ticket");
            $("#ticketreplybutton").show();
            returned = false;
            }
            else{

            }    
      },
      complete: function() {$(".popup-loader").hide(); } , 
      error: function(e) {
      console.log(e);
      }
  });
  
  if(!returned){
    // console.log(returned);
    return false;
  } 
}
function cancelupdate(property,propertyid,group,groupid,staff,staffid,priority,status,classval,version,cc,access) {
    $("#cancelupdate").addClass('disabled');
    $("#topupdatebuttonforticket").addClass('disabled');
    $("#topupdatebuttonforticket_not").addClass('disabled');
    $("#propertyval").text(property);
    $(document).ready(()=>{
            $("#property_id").val(propertyid);
        });
    $("#groupval").text(group);
    $(document).ready(()=>{
            $("#assigned_to").val(groupid);
        });
    $("#staffval").text(staff);
    $(document).ready(()=>{
            $("#assigned_to_staff").val(staffid);
        });
    $("#cc_priority_value").removeClass('has-color-high');
    $("#cc_priority_value").removeClass('has-color-medium');
    $("#cc_priority_value").removeClass('has-color-low');
    $("#cc_priority_value").removeClass('has-color-showstopper');
    $("#cc_priority_value").addClass('has-color-'.concat(priority));
    $("#priorityval").text(priority);
    $(document).ready(()=>{
            $("#priority").val(priority);
        });
    $("#statusval").text(status);
    $(document).ready(()=>{
            $("#status").val(status);
        });
        $("#classval").text(classval);
    $(document).ready(()=>{
            $("#class").val(classval);
        });    
    $("#versionval").text(version);
    $("#version").val(version);
    $("#ccval").text(cc);
    $("#cc_emails").val(cc);
    var chars = access.split(',');
    $(document).ready(()=>{
            $("#accessible_users").val(chars);
            $('.select-two-dd').select2();
        });

}

function updateTicketValues(notify) {
    console.log('test');
    accessible_users = "";
    var staff = $('#assigned_to_staff').val();
    console.log(staff);
    $(".error").remove();
    if($("#accessible_users").val().length > 0) {
        accessible_users = $("#accessible_users").val().join(",");
    }
    
    if (staff == '') {
        $('#assigned_to_staff').after('<span class="error" style="padding-top: 11px; color:red;">Staff is required</span>');
        $(window).scrollTop(0);
        return false;
    }
    if( ( $("#onprocesscheckedlists").val() != $("#completedcheckedlists").val()) && $("#status").val() == 'closed') {
        $(".topupdatebuttonforticket").removeClass('disabled').addClass("disabled");
        alert("You are not allowed to close the ticket until all the tasks are marked complete");
        return false;
    }
    if($("#status").val() != 'closed'){
        $('.hiddenbtn').removeClass('hiddenbtn');
        $('.closedtag').addClass('hiddenbtn');
        $("#accessible_users").removeAttr('disabled').show();
    }else{
        $('.closedtag').removeClass('hiddenbtn');
        $('.viewedbtncls').addClass('hiddenbtn');
        $("#accessible_users").attr('disabled', 'true');
    }

    var baseurl = $('meta[name="baseurl"]').attr('content');
    var mytoken = $('meta[name="csrf-token"]').attr('content');
    var versionclass = ($("#class").val()  != undefined && $("#class").val()  != '') ? $("#class").val()  : '';
    var version = ($("#version").val()  != undefined && $("#version").val()  != '') ? $("#version").val()  : '';
    var cc_emails = ($("#cc_emails").val()  != undefined && $("#cc_emails").val()  != '') ? $("#cc_emails").val()  : ''; 
    $(".topupdatebuttonforticket").addClass("disabled");
    $.ajax({
        url: baseurl + '/admin/tickets/devsummarycheck',
        method: 'POST',
        dataType: 'json',
        data: { _token: mytoken , ticket_id : {{ $ticket->id }} } ,
        beforeSend: function() { $(".popup-loader").show(); },
        success: function(data) {
            console.log(data);
            var returned = true;
            if(data[0]['res'] == 0 && $("#status").val() == 'closed' && data[0]['type'] == 14 && $("#class").val() == 'bug'){
                $(".topupdatebuttonforticket").removeClass('disabled').addClass("disabled");
                alert("Please fill in the RCA field before closing the ticket");
                returned = false;
                return false; 
            }
            else
            {

            }
            calledFromAjaxSuccess(returned);  
        },
        complete: function() {$(".popup-loader").hide(); } ,
        error: function(e) {
            console.log(e);
        }

    });
    function calledFromAjaxSuccess(result) {
        if($("#ticket_hide_type").val() == 'customer'){
            if(result) {
                $.ajax({
                    url: baseurl + '/admin/tickets/{{ $ticket->id }}/update-ticket-values',
                    method: 'POST',
                    data: '_token=' + mytoken + '&priority=' + $("#priority").val() + '&assigned_to=' + $("#assigned_to").val() + '&assigned_to_staff=' + $("#assigned_to_staff").val() + '&status=' + $("#status").val() + '&property_id=' + $("#property_id").val() + '&accessible_users='+accessible_users+'&class='+ versionclass  + '&version='+ version + "&notify="+notify + "&cc_emails="+cc_emails+ '&hide_ticketid='+ $("#hide_ticketid").val() ,
                    success: function(data) {
                        console.log(data);
                        if(data.has_deleted == 1){
                            alert('Please select a new staff');    
                            showSelect('assigned_to_staff');            
                        }
                        $("#alert-success-update").show();
                        if ($("#status").val() == 'closed') {
                            $("#replyticketcontainer, #profile_update_sendSms").hide();
                        } else {
                            $("#replyticketcontainer, #profile_update_sendSms").show();
                        }
                        window.location.reload();
                    },
                    error: function(e) {
                        console.log(e);
                    }

                });
            }else{
                return false;
            }
        }else{
            if(result) {
                $.ajax({
                    url: baseurl + '/admin/tickets/{{ $ticket->id }}/update-ticket-values',
                    method: 'POST',
                    data: '_token=' + mytoken + '&priority=' + $("#priority").val() + '&assigned_to=' + $("#assigned_to").val() + '&assigned_to_staff=' + $("#assigned_to_staff").val() + '&status=' + $("#status").val() + '&property_id=' + $("#property_id").val() + '&accessible_users='+accessible_users + '&class='+ versionclass  + '&version='+ version + "&notify="+notify + "&cc_emails="+cc_emails+ '&hide_ticketid='+ $("#hide_ticketid").val() ,
                    success: function(data) {
                        console.log(data);
                        if(data.has_deleted == 1){
                            alert('Please select a new staff');    
                            showSelect('assigned_to_staff');            
                        }
                        $("#alert-success-update").show();
                        if ($("#status").val() == 'closed') {
                            $("#replyticketcontainer, #profile_update_sendSms").hide();
                        } else {
                            $("#replyticketcontainer, #profile_update_sendSms").show();
                        }
                        window.location.reload();
                    },
                    error: function(e) {
                        console.log(e);
                    }

                });
            }else{
                return false;
            }
        }
    }
}

function getUser(value) {
    var baseurl = $('meta[name="baseurl"]').attr('content');
    $.ajax({
        url: baseurl + '/admin/tickets/get-user',
        method: 'GET',
        data: "_token={{ csrf_token() }}&group_id=" + value,
        success: function(data) {
            console.log(data);
            $("#assigned_to_staff").html(data.options).removeAttr('disabled').show();
            if (data.count == 0 || value == '') {
                $("#assigned_to_staff").attr('disabled', 'true');
            }
        },
        error: function(e) {
            console.log(e);
        }

    });

}

function getUserBottom(value) {
    var baseurl = $('meta[name="baseurl"]').attr('content');
    $.ajax({
        url: baseurl + '/admin/tickets/get-user',
        method: 'GET',
        data: "_token={{ csrf_token() }}&group_id=" + value,
        success: function(data) {
            console.log(data);
            $("#assigned_to_staff_bottom").html(data.options).removeAttr('disabled').show();
            if (data.count == 0 || value == '') {
                $("#assigned_to_staff_bottom").attr('disabled', 'true');
            }
        },
        error: function(e) {
            console.log(e);
        }

    });

}

function toggleMessages() {
    $("#textmessage_allmessages").toggle();
    if ($("#a_expand_collapse_tag").text() == 'Expand') {
        $("#a_expand_collapse_tag").html("Collapse");
        $("#form_sms_twilio_message").focus();
    } else {
        $("#a_expand_collapse_tag").html("Expand");
    }

}

function act_toggleMessages() {
    $(".activity_history_form_panel").toggle();
    if ($("#act_a_expand_collapse_tag").text() == 'Expand') {
        $("#act_a_expand_collapse_tag").html("Collapse");
        $("#act_form_sms_twilio_message").focus();
    } else {
        $("#act_a_expand_collapse_tag").html("Expand");
    }

}

function open_checklistMessages() {
    $("#check_a_expand_collapse_tag").html("Expand");
    $("#check_textmessage_allmessages").show();
    $("#scroll_to_checklist").focus();
    $('html, body').animate({
        scrollTop: $("#scroll_to_checklist").offset().top - 123
    }, 0);
}

function check_toggleMessages() {
    $("#check_textmessage_allmessages").toggle();
    if ($("#check_a_expand_collapse_tag").text() == 'Expand') {
        $("#check_a_expand_collapse_tag").html("Collapse");
        $("#check_form_sms_twilio_message").focus();
    } else {
        $("#check_a_expand_collapse_tag").html("Expand");
    }

}

function expandAllNotes() {
    $("#expandAllNotes_form").toggle();
    if ($("#act_a_expand_collapse_notesbox").text() == 'Expand') {
        $("#act_a_expand_collapse_notesbox").html("Collapse");
        $("#form_collapse_notesbox").focus();
    } else {
        $("#act_a_expand_collapse_notesbox").html("Expand");
    }

}

function focusNotes() {
    $("#ec_notescontainer").show();
    $("#ec_notescontainer_header").addClass('header-active');
    $('html, body').animate({
        scrollTop: $("#notes_whole_block").offset().top - 123
    }, 0);
    $("#notes_whole_block").focus();

}
function focusContacts() {
    $("#ec_contactscontainer").show();
    $("#ec_contactscontainer_header").addClass('header-active');
    $('html, body').animate({
        scrollTop: $("#contact_whole_block").offset().top - 200
    }, 0);
    $("#contact_whole_block").focus();

}

function loadMessageByNumber(value) {
    $(".popup-loader").show();
    window.location.href = "{{ URL::action('Admin\\TicketsController@show', $ticket->id) }}" + "?user_number=" + value;
}

function gotoRequiredBlock(tree, id) {
   console.log(id, tree);
       if((tree == 'update' || tree == 'reply') && id != 0) {
        $("#all_ticket_email_messages_header").addClass('header-active');
        $("#all_ticket_email_messages").removeClass('display-none');
           var className = $.trim($("#ticket_history_" + id + " .accordian-panel i").attr('class'));
           if (className == 'fa fa-plus') {
                   toggleAccordian(id);
           }
           $('html, body').animate({
               scrollTop: $("#ticket_history_"+id).offset().top - 135
           }, 0);
           $("#ticket_history_"+id).focus();
       }
        if((tree == 'update' || tree == 'reply') && id == 0) {
               $('html, body').animate({
               scrollTop: $(".view-notes-panel-content").offset().top - 100
           }, 0);
           $(".view-notes-panel-content").focus();
        }
         if(tree == 'text_message' || tree == 'incoming' || tree == 'outgoing') {
           focusSmS();
         }

        if(tree == 'checklist') {
           open_checklistMessages();
         }
         
       if((tree == 'note' || tree == 'note_update' ) && id != 0) {
            $("#ec_notescontainer_header").addClass('header-active');
            $("#ec_notescontainer").removeClass('display-none');
           var className = $.trim($("#notes_grid_view_" + id + " .accordian-panel i").attr('class'));
           if (className == 'fa fa-plus') {
                   toggleAccordianNotes(id);
           }
           $('html, body').animate({
               scrollTop: $("#notes_grid_view_"+id).offset().top - 135
           }, 0);
           $("#notes_grid_view_"+id).focus();
       }
       if(tree == 'create') {
           $('html, body').animate({
                   scrollTop: $(".top-border-panel").offset().top - 140
           }, 0);
           $(".top-border-panel").focus();
           
       }
}
getLimitBasedOnClick("form_sms_twilio_message"); 

 function showSaveCancelBlock() {
    $("#save_cancel_block").attr("style", "display: flex;");
 }
 function selectCustomerOrStaff(id)
    {
        var checked = $("#checklist_"+id+"_staff_or_customer").val();
        console.log(checked);
        $(".popup-loader").show();
        var baseurl = $('meta[name="baseurl"]').attr('content');
            var mytoken = $('meta[name="csrf-token"]').attr('content');
                $.ajax({
                url: baseurl+'/admin/tickets/{{ $ticket->id }}/'+checked+'/load-users-or-staffs',
                method: 'GET',
                success: function(data){
                  console.log(data);
                  $("#checklist_"+id+"_staff").html(data.options).trigger('change');
                   $(".popup-loader").hide();
                },
                error: function(e) {
                        console.log(e);
                         $(".popup-loader").hide();
                    }

              });
    }

    function cloneChecklist() {
        var id = $("#exisiting_checklist_count").val();
        var nextId = parseInt(id) + 1 ;
        $(".popup-loader").show();
        $('#dynamic_checklist_here_'+id).load(window.baseUrl+'/admin/tickets/{{ $ticket->id }}/clone/'+nextId+'/checklist', function(){
            $(".popup-loader").hide();
            $(".select-two-dd").select2();
            $('.daterangepickerinputsingle').daterangepicker({
                singleDatePicker: true,
                autoUpdateInput: false,
                minDate: "@php $today = date('m/d/y'); echo $today; @endphp"
            }, function(start_date, end_date) {
            });
            $('.daterangepickerinputsingle').on('apply.daterangepicker', function(ev, picker) {
                $(this).val(picker.startDate.format('MM/DD/YYYY'));
           });

        });
        $("#exisiting_checklist_count").val(nextId);
    }

    function removeClone(id) {
        if (confirm('Are you sure want to delete?')) {
            $("#remove_cloned_item_"+id).remove();
        }
    }

    function resetForm(formid) {
        $("#"+formid)[0].reset();
        $('#'+formid+' .select-two-dd').trigger("change")
    }
    
    function deleteChecklist(id) {
        if (confirm('Are you sure want to delete?')) {
         $(".popup-loader").show();
        var baseurl = $('meta[name="baseurl"]').attr('content');
            var mytoken = $('meta[name="csrf-token"]').attr('content');
                $.ajax({
                url: baseurl+'/admin/tickets/{{ $ticket->id }}/checklist/'+id+'/delete',
                method: 'GET',
                success: function(data){
                  console.log(data);
                  $("#gridviewpanel_"+id).remove();
                   $(".popup-loader").hide();
                },
                error: function(e) {
                        console.log(e);
                         $(".popup-loader").hide();
                    }

              });
            }
    }

    function loadTemplateChecklists(value) {
         $(".popup-loader").show();
        var id = $("#exisiting_checklist_count").val();
        var nextId = parseInt(id) + 1 ;
        var baseurl = $('meta[name="baseurl"]').attr('content');
            var mytoken = $('meta[name="csrf-token"]').attr('content');
                $.ajax({
                url: baseurl+'/admin/tickets/{{ $ticket->id }}/template/'+value+'/clone/'+nextId+'/loadchecklists',
                method: 'GET',
                success: function(data){
                  //console.log(data);
                  $(".dynamic_checklist_here").last().after(data);
                   $(".popup-loader").hide();
                   $(".select-two-dd").select2();
                   $("#exisiting_checklist_count").val($(".dynamic_checklist_here").length);
                        $('.daterangepickerinputsingle').daterangepicker({
                            singleDatePicker: true,
                            autoUpdateInput: false,
                            minDate: "@php $today = date('m/d/y'); echo $today; @endphp"
                        }, function(start_date, end_date) {
                        });
                        $('.daterangepickerinputsingle').on('apply.daterangepicker', function(ev, picker) {
                            $(this).val(picker.startDate.format('MM/DD/YYYY'));
                       });
                },
                error: function(e) {
                        console.log(e);
                         $(".popup-loader").hide();
                    }

              });
    }

function allExpandCollapse() {
    var text = $.trim($("#expand_all_collapse_all").text());
    if(text == 'Expand all') {
        $("#expand_all_collapse_all").text('Collapse all');
        $(".viewpage-accordian-header .cus-table-header").addClass("header-active");
        $("#ec_ticket_container, #all_ticket_email_messages, #check_textmessage_allmessages, #ec_activityhistory_panel, #textmessage_allmessages,#ec_notescontainer").show();
        tabOptions('tab/filters/activities', 't_f_ticket_activites', 'tickets', 'activity');
        tabOptions('tab/filters/tasks', 't_f_ticket_tasks', 'tickets', 'tasks');       
        CEToggle('ec_transaction_detailscontainer'); viewTransactionDetails(); 
        CEToggle('ec_work_order_detailscontainer'); viewWorkOrderDetails();
        CEToggle('ec_leasing_detailscontainer'); viewLeasingDetails();
        CEToggle('ec_dev_detailscontainer'); editDevDetail();
        CEToggle('ec_rental_listing_detailcontainer'); viewRentalListingDetail();        
        CEToggle('ec_qtocontainer');               
        getRelatedTickets();
        $("#all_ticket_email_messages .ticket-panel .fa").removeClass('fa-plus').addClass('fa-minus');
        $("#act_a_expand_collapse_replybox").html("Collapse");
        $("#all_ticket_email_messages .ticket-panel").addClass('full-height');
        $('html, body').animate({
            scrollTop: $("#ec_ticket_container").offset().top - 250
        }, 0);
    } else {
        $("#expand_all_collapse_all").text('Expand all');
        $(".viewpage-accordian-header .cus-table-header").removeClass("header-active");
        $("#ec_ticket_container, #all_ticket_email_messages, #check_textmessage_allmessages, #ec_activityhistory_panel, #textmessage_allmessages, #ec_notescontainer").hide();
        $("#all_ticket_email_messages .ticket-panel .fa").removeClass('fa-minus').addClass('fa-plus');
        $("#act_a_expand_collapse_replybox").html("Expand");
        $("#all_ticket_email_messages .ticket-panel").removeClass('full-height');
        CEToggle('ec_transaction_detailscontainer'); viewTransactionDetails(); 
        CEToggle('ec_work_order_detailscontainer'); viewWorkOrderDetails();
        CEToggle('ec_leasing_detailscontainer'); viewLeasingDetails();
        CEToggle('ec_dev_detailscontainer'); viewDevDetail();
        CEToggle('ec_rental_listing_detailcontainer'); viewRentalListingDetail();        
        CEToggle('ec_qtocontainer'); 
        getRelatedTickets();              
        $('html, body').animate({
            scrollTop: $("#ec_ticket_container").offset().top - 123
        }, 0);
    }
}

function checkStaffInList(userId, index, ticketId){
    if(userId != 0)
    {
        event.preventDefault();
        $(".popup-loader").show();
        $.ajax({
            url: baseurl + '/admin/tickets/{{ $ticket->id }}/'+userId+"/has-access",
            method: 'GET',
            data: '',
            success: function(data) {
                console.log(data);
                $(".popup-loader").hide();
                if(data.access == 1) {
                    //$("#checklist_"+index+"_staff").val(userId).trigger('change');
                } else {
                    if(confirm('The selected task assignee '+data.userName+'  is not part of ticket Access list or Group, would you like to add them to Access list ?')) 
                    {
                        addusertoaccesslist(userId, index, ticketId);
                    }else {
                        $("#checklist_"+index+"_staff").val(0).trigger('change');
                    }
                }
            },
            error: function(e) {
                console.log(e);
                $(".popup-loader").hide();
            }

        });
        return false;
    }
}

function addusertoaccesslist(userId, index, ticketId){
    if(userId != 0)
    {
        event.preventDefault();
        $(".popup-loader").show();
        $.ajax({
            url: baseurl + '/admin/tickets/{{ $ticket->id }}/'+userId+"/add-to-access",
            method: 'GET',
            data: '',
            success: function(data) {
                console.log(data);
                $(".popup-loader").hide();
                //$("#checklist_"+index+"_staff").val(userId).trigger('change');
                $("#accessible_users").val(data.accessUserIds).trigger('change');
            },
            error: function(e) {
                console.log(e);
                $(".popup-loader").hide();
            }

        });
        return false;
    }
    //alert(id);
}
function editTransactionDetails(){
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#transaction_details_dynamic_content").html($image).show();
    $.ajax({
    url: baseurl+'/admin/ticket/{{$ticket->id}}/transaction-details/edit',
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
          $("#transaction_details_dynamic_content").html(data);
          console.log(data.return);
      }, error: function(e) {
          console.log(e);
      }
  });
}
function viewTransactionDetails(){
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#transaction_details_dynamic_content").html($image).show();
    $.ajax({
    url: baseurl+'/admin/ticket/{{$ticket->id}}/transaction-details/view',
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
      $("#transaction_details_dynamic_content").html(data);

      }, error: function(e) {
          console.log(e);
      }
  });
}
function editWorkOrderDetails(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >';
    $("#work_order_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('editWorkOrderDetails', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
          $("#work_order_details_dynamic_content").html(data);
          // console.log(data.return);
      }, error: function(e) {
          console.log(e);
      }
  });
}
function editRentalListingDetail(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >';
    $("#rental_listing_detail_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('editRentalListingDetail', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),

    success: function(data){
          $("#rental_listing_detail_dynamic_content").html(data);
          // console.log(data.return);
      }, error: function(e) {
          console.log(e);
      }
  });

}
function viewWorkOrderDetails(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#work_order_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('viewWorkOrderDetails', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
      $("#work_order_details_dynamic_content").html(data);

      }, error: function(e) {
          console.log(e);
      }
  });
}

function viewRentalListingDetail(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#rental_listing_detail_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('viewRentalListingDetail', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
      $("#rental_listing_detail_dynamic_content").html(data);

      }, error: function(e) {
          console.log(e);
      }
  });
}




function editLeasingDetails(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >';
    $("#leasing_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('editLeasingDetails', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
          $("#leasing_details_dynamic_content").html(data);
          // console.log(data.return);
      }, error: function(e) {
          console.log(e);
      }
  });
}
function viewLeasingDetails(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#leasing_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('viewLeasingDetails', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
      $("#leasing_details_dynamic_content").html(data);

      }, error: function(e) {
          console.log(e);
      }
  });
}

function editDevDetail(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >';
    $("#dev_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('editDevDetail', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),

    success: function(data){
          $("#dev_details_dynamic_content").html(data);
          // console.log(data.return);
      }, error: function(e) {
          console.log(e);
      }
  });

}
function viewDevDetail(){
    // alert();
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#dev_details_dynamic_content").html($image).show();
    $.ajax({
    url: "{{route('viewDevDetail', ['ticket' => $ticket->id])}}",
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
      $("#dev_details_dynamic_content").html(data);

      }, error: function(e) {
          console.log(e);
      }
  });
}



function showuserbstickets(ticketid, customerid){
    $image = '<img src="'+$(".popup-loader img").attr('src')+'" width="50" height="50" >'
    $("#dynamic_qto_tickets").html($image).show();
    $.ajax({
    url: baseurl+'/admin/ticket/'+ticketid+'/customer/'+customerid+'/buyer/support',
    method: 'GET',
    data:"_token="+$('meta[name="csrf-token"]').attr('content'),
    success: function(data){
          $("#qtoEdit-modal").modal('show');
          $("#dynamic_qto_tickets").html(data);
          console.log(data);
      }, error: function(e) {
          console.log(e);
      }
  });
}


function toggleComment(id) {
        $("#toggle_comment_input_"+id).show().focus();
        $("#toggle_comment_span_"+id).hide();
        contactCancelBlock();
      }

      function contactCancelBlock() {
        $("#conatct_save_cancel_block").show();
      }


//Pres
function sortbyduedate(value) {
$("ul#sortable li").each(function () {
$('ul#sortable li').show();
});
    if(value == 2){
    var container = $(".ul#sortable");
    var items = $(".sortduedate");
    items.each(function() {
       var BCDate = $(this).attr("dueDate").split("-");
       var standardDate = BCDate[1]+" "+BCDate[0]+" "+BCDate[2];
       standardDate = new Date(standardDate).getTime();
       $(this).attr("dueDate", standardDate);
    });
    items.sort(function(a,b){
        a = parseFloat($(a).attr("dueDate"));
        b = parseFloat($(b).attr("dueDate"));
        return a>b ? -1 : a<b ? 1 : 0;
    }).each(function(){
      $("ul#sortable").prepend(this);
    });
            }else{
    var container = $(".ul#sortable");
    var items = $(".sortduedate");
    items.each(function() {
       var BCDate = $(this).attr("dueDate").split("-");
       var standardDate = BCDate[1]+" "+BCDate[0]+" "+BCDate[2];
       standardDate = new Date(standardDate).getTime();
       $(this).attr("dueDate", standardDate);
    });
    items.sort(function(a,b){
        a = parseFloat($(a).attr("dueDate"));
        b = parseFloat($(b).attr("dueDate"));
        return a>b ? -1 : a>b ? 1 : 0;
    }).each(function(){
      $("ul#sortable").prepend(this);
    });
            }
}
function sortbyvalidate(value) {
if (value == 1) {
     $("input:checkbox:not(:checked).validatecheckbox").each(function () {
         console.log($(this).attr("id"));
          $('ul#sortable li.'+$(this).attr("id")).hide();
        });
     $("input[type='checkbox']:checked.validatecheckbox ").each(function () {
         console.log($(this).attr("id"));
          $('ul#sortable li.'+$(this).attr("id")).show();
        });
}else{
     $("input[type='checkbox']:checked.validatecheckbox ").each(function () {
         console.log($(this).attr("id"));
          $('ul#sortable li.'+$(this).attr("id")).hide();
        });
     $("input:checkbox:not(:checked).validatecheckbox").each(function () {
         console.log($(this).attr("id"));
          $('ul#sortable li.'+$(this).attr("id")).show();
        });
}
}
    function sortbyname(value) {
        $("ul#sortable li").each(function () {
          $('ul#sortable li').show();
        });
        var assignedstaff = [];
        $('#sortable li').each(function(){
          var assigStaff = [];
          assigStaff.push($('.datasort', this).text());
          assigStaff.push($(this));
          assignedstaff.push(assigStaff);
          assignedstaff.sort();
        })
        if (value == 0) {
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.datasortName:first').text(), b = $(b).find('.datasortName:first').text();
              return a.localeCompare(b, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
                }else if(value == 1){
          $("#sortable li").sort(sort_li).appendTo('#sortable');
          function sort_li(a, b) {
            return ($(b).data('position')) < ($(a).data('position')) ? 1 : -1;
          }
        }else if(value == 2){
           function ddmmyyyy(s){
            var part=s.split("-"),
            date=new Date()
            date.setYear(part[2])
            date.setMonth(part[1]-1)
            date.setDate(part[0])
            return date
            }
        function ddmmyyyClassSort(a,b){
                var A=ddmmyyyy(a.getAttribute('duedate')),
                    B=ddmmyyyy(b.getAttribute('duedate'))
                return A<B? 1 : -1
            }
        $.fn.sortChildren=function(cmp){
            var self=this,
                children=$.makeArray(this.children()).sort(cmp)
            $.each(children, function(i, child){
                // self.append(child)
                 $('ul#sortable').append(child);
            })
            return self
        }
        $(function(){
            $('ul#sortable').sortChildren(ddmmyyyClassSort)
                        $('#sortable .task-list-panel').each(function(index, value) {
                    var li_id = $(this).attr("id");
                    $("#"+li_id+"_position").prop("value", index+1);
                    var element = document.getElementById(li_id+"_position");
                    element.setAttribute('value', index+1)
                });
        })
        }else if(value == 3){
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("validatecheckbox")[0].checked) {
                    checked.appendChild(origOrder[i]);
                } else {
                    unchecked.appendChild(origOrder[i]);
                }
            }
            list.append(checked).append(unchecked);
        }else if(value == 4){
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("closed")[0]) {
                    checked.appendChild(origOrder[i]);
                } else {
                    unchecked.appendChild(origOrder[i]);
                }
            }
            list.append(unchecked).append(checked);
        }else{
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("sortshared")[0].checked) {
                    checked.appendChild(origOrder[i]);
                } else {
                    unchecked.appendChild(origOrder[i]);
                }
            }
            list.append(checked).append(unchecked);
        }
        $('#sortable .task-list-panel').each(function(index, value) {
                var li_id = $(this).attr("id");
                $("#"+li_id+"_position").prop("value", index+1);
                var element = document.getElementById(li_id+"_position");
                element.setAttribute('value', index+1)
            });
    }

    function sortbyAscDesc(value) {
        $("ul#sortable li").each(function () {
          $('ul#sortable li').show();
        });
        var assignedstaff = [];
        $('#sortable li').each(function(){
          var assigStaff = [];
          assigStaff.push($('.datasort', this).text());
          assigStaff.push($(this));
          assignedstaff.push(assigStaff);
          assignedstaff.sort();
        })
        if (value == 0) {
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByNameID i").removeClass('fa-long-arrow-down active');
            $("#sortByNameID i").addClass('fa-long-arrow-up active');
            $("#sortByNameID").attr("onclick","sortbyAscDesc(101)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.datasortName:first').text(), b = $(b).find('.datasortName:first').text();
              return a.localeCompare(b, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 101){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByNameID i").removeClass('fa-long-arrow-up active');
            $("#sortByNameID i").addClass('fa-long-arrow-down active');
            $("#sortByNameID").attr("onclick","sortbyAscDesc(0)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.datasortName:first').text(), b = $(b).find('.datasortName:first').text();
              return b.localeCompare(a, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 1){
                $(".TaskMainLabel label i").removeClass('active');
                $("#sortByAssgStaffID i").removeClass('fa-long-arrow-down active');
                $("#sortByAssgStaffID i").addClass('fa-long-arrow-up active');
                $("#sortByAssgStaffID").attr("onclick","sortbyAscDesc(111)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.sortByAssgStaffClass:first').text(), b = $(b).find('.sortByAssgStaffClass:first').text();
              return a.localeCompare(b, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 111){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByAssgStaffID i").removeClass('fa-long-arrow-up active');
            $("#sortByAssgStaffID i").addClass('fa-long-arrow-down active');
            $("#sortByAssgStaffID").attr("onclick","sortbyAscDesc(1)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.sortByAssgStaffClass:first').text(), b = $(b).find('.sortByAssgStaffClass:first').text();
              return b.localeCompare(a, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 2){
        $(".TaskMainLabel label i").removeClass('active');
        $("#sortByDueDateID i").removeClass('fa-long-arrow-down active');
        $("#sortByDueDateID i").addClass('fa-long-arrow-up active');
        $("#sortByDueDateID").attr("onclick","sortbyAscDesc(222)");
       function ddmmyyyy(s){
        var part=s.split("-"),
        date=new Date()
        date.setYear(part[2])
        date.setMonth(part[1]-1)
        date.setDate(part[0])
        return date
    }
    function ddmmyyyClassSort(a,b){
            var A=ddmmyyyy(a.getAttribute('duedate')),
                B=ddmmyyyy(b.getAttribute('duedate'))
            return A<B? 1 : -1
        }
    $.fn.sortChildren=function(cmp){
        var self=this,
            children=$.makeArray(this.children()).sort(cmp)
        $.each(children, function(i, child){
             $('ul#sortable').append(child);
        })
        return self
    }
    $(function(){
        $('ul#sortable').sortChildren(ddmmyyyClassSort)
        $('#sortable .task-list-panel').each(function(index, value) {
            var li_id = $(this).attr("id");
            $("#"+li_id+"_position").prop("value", index+1);
            var element = document.getElementById(li_id+"_position");
            element.setAttribute('value', index+1)
        });
    })
        }else if(value == 222){
        $(".TaskMainLabel label i").removeClass('active');
        $("#sortByDueDateID i").removeClass('fa-long-arrow-up active');
        $("#sortByDueDateID i").addClass('fa-long-arrow-down active');
        $("#sortByDueDateID").attr("onclick","sortbyAscDesc(2)");
       function ddmmyyyy(s){
        var part=s.split("-"),
        date=new Date()
        date.setYear(part[2])
        date.setMonth(part[1]-1)
        date.setDate(part[0])
        return date
    }
    function ddmmyyyClassSort(a,b){
            var A=ddmmyyyy(a.getAttribute('duedate')),
                B=ddmmyyyy(b.getAttribute('duedate'))
            return A>B? 1 : -1
        }
    $.fn.sortChildren=function(cmp){
        var self=this,
            children=$.makeArray(this.children()).sort(cmp)
        $.each(children, function(i, child){
            // self.append(child)
             $('ul#sortable').append(child);
        })
        return self
    }
    $(function(){
        $('ul#sortable').sortChildren(ddmmyyyClassSort)
                    $('#sortable .task-list-panel').each(function(index, value) {
                var li_id = $(this).attr("id");
                $("#"+li_id+"_position").prop("value", index+1);
                var element = document.getElementById(li_id+"_position");
                element.setAttribute('value', index+1)
            });
    })
        }else if(value == 3){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByValidateID i").removeClass('fa-long-arrow-down active');
            $("#sortByValidateID i").addClass('fa-long-arrow-up active');
            $("#sortByValidateID").attr("onclick","sortbyAscDesc(333)");
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("validatecheckbox")[0].checked) {
                    checked.appendChild(origOrder[i]);
                } else {
                    unchecked.appendChild(origOrder[i]);
                }
            }
            list.append(checked).append(unchecked);
        }else if(value == 333){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByValidateID i").removeClass('fa-long-arrow-up active');
            $("#sortByValidateID i").addClass('fa-long-arrow-down active');
            $("#sortByValidateID").attr("onclick","sortbyAscDesc(3)");
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("validatecheckbox")[0].checked) {
                    unchecked.appendChild(origOrder[i]);
                } else {
                    checked.appendChild(origOrder[i]);
                }
            }
            list.append(checked).append(unchecked);
        }else if(value == 4){
        $(".TaskMainLabel label i").removeClass('active');
        $("#sortByCompletedID i").removeClass('fa-long-arrow-down active');
        $("#sortByCompletedID i").addClass('fa-long-arrow-up active');
        $("#sortByCompletedID").attr("onclick","sortbyAscDesc(444)");
        var list = $("ul#sortable"),
        origOrder = list.children();
        var i, checked = document.createDocumentFragment(),
            unchecked = document.createDocumentFragment();
        for (i = 0; i < origOrder.length; i++) {
            if (origOrder[i].getElementsByClassName("closed")[0]) {
                unchecked.appendChild(origOrder[i]);
            } else {
                checked.appendChild(origOrder[i]);
            }
        }
        list.append(unchecked).append(checked);
        }else if(value == 444){
        $(".TaskMainLabel label i").removeClass('active');
        $("#sortByCompletedID i").removeClass('fa-long-arrow-up active');
        $("#sortByCompletedID i").addClass('fa-long-arrow-down active');
        $("#sortByCompletedID").attr("onclick","sortbyAscDesc(4)");
        var list = $("ul#sortable"),
        origOrder = list.children();
        var i, checked = document.createDocumentFragment(),
            unchecked = document.createDocumentFragment();
        for (i = 0; i < origOrder.length; i++) {
            if (origOrder[i].getElementsByClassName("closed")[0]) {
                checked.appendChild(origOrder[i]);
            } else {
                unchecked.appendChild(origOrder[i]);
            }
        }
        list.append(unchecked).append(checked);
        }else if(value == 5){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortBySharedID i").removeClass('fa-long-arrow-down active');
            $("#sortBySharedID i").addClass('fa-long-arrow-up active');
            $("#sortBySharedID").attr("onclick","sortbyAscDesc(555)");
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("sortshared")[0].checked) {
                    checked.appendChild(origOrder[i]);
                } else {
                    unchecked.appendChild(origOrder[i]);
                }
        }
        list.append(checked).append(unchecked);
        }else if(value == 555){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortBySharedID i").removeClass('fa-long-arrow-down active');
            $("#sortBySharedID i").addClass('fa-long-arrow-up active');
            $("#sortBySharedID").attr("onclick","sortbyAscDesc(5)");
            var list = $("ul#sortable"),
            origOrder = list.children();
            var i, checked = document.createDocumentFragment(),
                unchecked = document.createDocumentFragment();
            for (i = 0; i < origOrder.length; i++) {
                if (origOrder[i].getElementsByClassName("sortshared")[0].checked) {
                    unchecked.appendChild(origOrder[i]);
                } else {
                    checked.appendChild(origOrder[i]);
                }
        }
        list.append(checked).append(unchecked);
        }else if(value == 6){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByCreatedID i").removeClass('fa-long-arrow-down active');
            $("#sortByCreatedID i").addClass('fa-long-arrow-up active');
            $("#sortByCreatedID").attr("onclick","sortbyAscDesc(666)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.sortcreated').text(), b = $(b).find('.sortcreated').text();
              return a.localeCompare(b, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 666){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByCreatedID i").removeClass('fa-long-arrow-up active');
            $("#sortByCreatedID i").addClass('fa-long-arrow-down active');
            $("#sortByCreatedID").attr("onclick","sortbyAscDesc(6)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.sortcreated').text(), b = $(b).find('.sortcreated').text();
              return b.localeCompare(a, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else if(value == 7){
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByUpdatedID i").removeClass('fa-long-arrow-down active');
            $("#sortByUpdatedID i").addClass('fa-long-arrow-up active');
            $("#sortByUpdatedID").attr("onclick","sortbyAscDesc(777)");
            var sorted = $('#sortable li').sort(function(a, b) {
              var a = $(a).find('.sortupdated').text(), b = $(b).find('.sortupdated').text();
              return a.localeCompare(b, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }else{
            $(".TaskMainLabel label i").removeClass('active');
            $("#sortByUpdatedID i").removeClass('fa-long-arrow-up active');
            $("#sortByUpdatedID i").addClass('fa-long-arrow-down active');
            $("#sortByUpdatedID").attr("onclick","sortbyAscDesc(7)");
            var sorted = $('#sortable li').sort(function(a, b) {
            var a = $(a).find('.sortupdated').text(), b = $(b).find('.sortupdated').text();
            return b.localeCompare(a, false, {numeric: true})
            })
            $('ul#sortable').append(sorted);
        }
        $('#sortable .task-list-panel').each(function(index, value) {
                var li_id = $(this).attr("id");
                $("#"+li_id+"_position").prop("value", index+1);
                var element = document.getElementById(li_id+"_position");
                element.setAttribute('value', index+1)
            });
    }
  function triggeredchangevalidate(value, classs, name){
              if ($('#'+value).hasClass("triggerchecked")) {
$("#"+value).replaceWith('<input type="checkbox" id="'+value+'" class="checklist-checkbox showcheckbox validatecheckbox '+classs+'" onclick="showSaveCancelBlock();" value="1" name="'+name+'">');
}
}
  function changevalidate(value, classs, name){
      $('.'+classs).attr('name', name);
   var forValidate = $(this).data("forValidate");
    if($(value).prop("checked") == true){
        $(value).attr('checked', false);
        $(value).addClass('ItsChecked');
    }
    else if($(value).prop("checked") == false){
        if ($(value).hasClass("ItsChecked")) {
            $(value).attr('checked', true);
            $(value).removeClass('ItsChecked');
        }
    }
  }
  
  function Triggertask(){
      console.log("test task");
  }
  
  function gotoLastSMS() {
      var height = 0;
        $('#textmessage_allmessages .chat-inner-container .message-row').each(function(i, value){
            height += parseInt($(this).height());
        });
        height += '';
        $('#textmessage_allmessages .chat-inner-container').animate({scrollTop: height}, 0);
  }
//Pres
//datepicker-homesearch
$('.daterangepickerinputsingle, .daterangepickerinputsingle1').daterangepicker({
            singleDatePicker: true,
            autoUpdateInput: false,
        }, function(start_date, end_date) {
        });
      
       $('.daterangepickerinputsingle, .daterangepickerinputsingle1').on('apply.daterangepicker', function(ev, picker) {
            $(this).val(picker.startDate.format('MM/DD/YYYY'));
             if($("#advancedSearch-Modal").is(':hidden') || $("#advancedSearch-Modal").length == 0 ) {
                if($("#filter_due_date").length > 0) {
                      $("#filter_due_date").trigger('change');
                    }
            }
       });

    function CEToggleinside(id,editid) {
        if(!$('#'+editid).hasClass('val') || editid=='allowto'){
            $("#"+id).toggle();
            if ($("#"+id).is(':visible')){
                $("#"+id+"_header").addClass("header-active");
            } else {
                $("#"+id+"_header").removeClass("header-active");
            }
        }  
    }

    function CEToggleinsides(id,editid) {
        if(!$('#'+editid).hasClass('hiddenfileds') || editid=='allowto'){
            $("#"+id).toggle();
            if ($("#"+id).is(':visible')){
                $("#"+id+"_header").addClass("header-active");
            } else {
                $("#"+id+"_header").removeClass("header-active");
            }
        }  
    }

    function ocasummaryfileds(){
        if($('#form-control-static_customerfileds').hasClass('hiddenfileds')){    
            alert("Customer profile fields is in edit mode. Please click save or cancel button to edit this card");
        }else{
            if($('#admisstionsummaryFields_header').hasClass('header-active')){           
                $(".val").removeAttr('disabled');        
                $(".form-control-static_admisstionsummaryfields").addClass('val').hide();          
            }else{            
                CEToggleinside('admisstionsummaryFields','form-control-static_admisstionsummaryfields');
                $(".val").removeAttr('disabled');        
                $(".form-control-static_admisstionsummaryfields").addClass('val').hide();
            } 
        }
        $('.cancel-button').on('click', function () {
            $("#admisstionsummaryFields_header").removeClass("header-active");    // 
            $("#admisstionsummaryFields").css({display: 'none'});    
            $(".val").attr('disabled',true);
            $('.form-control-static_admisstionsummaryfields').removeClass('val').show();    
            
        });
    }

    function ocacustomerfileds(){
        if($('#form-control-static_admisstionsummaryfields').hasClass('val')){    
            alert("Admisstion summary fields is in edit mode. Please click save or cancel button to edit this card");
        }
        else{
            if($('#customerFields_header').hasClass('header-active')){ 
                $(".hiddenfileds").removeAttr('disabled');    
                $(".form-control-static_customerfileds").addClass('hiddenfileds').hide();  
            }
            else{                      
                CEToggleinsides('customerFields','form-control-static_customerfileds');
                $(".hiddenfileds").removeAttr('disabled');        
                $(".form-control-static_customerfileds").addClass('hiddenfileds').hide();
            } 
        }
        $('.cancelupdate').on('click', function () {
            $("#customerFields_header").removeClass("header-active");
            $("#customerFields").css({display: 'none'});
            $(".hiddenfileds").attr('disabled',true);
            $('.form-control-static_customerfileds').removeClass('hiddenfileds').show();     
        
        });
    }

</script>
@endsection
